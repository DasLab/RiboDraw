<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of draw_linker</title>
  <meta name="keywords" content="draw_linker">
  <meta name="description" content="linker = draw_linker( linker )">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html linkers -->
<h1>draw_linker
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>linker = draw_linker( linker )</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function linker = draw_linker( linker ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> linker = draw_linker( linker )
 linker = draw_linker( linkers )

 Draw the linker (arrow, stem_pair, noncanonical_pair, tertiary contact)
  including symbols.

 Input:
  linker = Linker object (or tag string) to draw. Cell of multiple linkers is also OK.
  
 Output:
  linker = Linker object potentially with updated plot_pos or graphics handles

 (C) R. Das, Stanford University, 2017</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="create_LW_symbol.html" class="code" title="function h = create_LW_symbol( edge, orientation, bp_spacing );">create_LW_symbol</a>	h = create_LW_symbol( edge, orientation, bp_spacing );</li><li><a href="create_linker_with_draggable_vtx.html" class="code" title="function linker = create_linker_with_draggable_vtx( linker )">create_linker_with_draggable_vtx</a>	linker = create_linker_with_draggable_vtx( linker )</li><li><a href="draw_linker.html" class="code" title="function linker = draw_linker( linker )">draw_linker</a>	linker = draw_linker( linker )</li><li><a href="first_crossing.html" class="code" title="function [v,start_pos,pointing_out_of_polygon] = first_crossing( polygon, plot_pos );">first_crossing</a>	first_crossing( polygon, plot_pos );</li><li><a href="get_arrow_linewidth.html" class="code" title="function arrow_linewidth = get_arrow_linewidth( fontsize );">get_arrow_linewidth</a>	arrow_linewidth = get_arrow_linewidth( fontsize );</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="create_linker_with_draggable_vtx.html" class="code" title="function linker = create_linker_with_draggable_vtx( linker )">create_linker_with_draggable_vtx</a>	linker = create_linker_with_draggable_vtx( linker )</li><li><a href="draw_linker.html" class="code" title="function linker = draw_linker( linker )">draw_linker</a>	linker = draw_linker( linker )</li><li><a href="rectify_linker.html" class="code" title="function linker = rectify_linker( linker, overwrite );">rectify_linker</a>	linker = rectify_linker();</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function linker = draw_default_linker( linker );</a></li><li><a href="#_sub2" class="code">function h = create_undercircle( bp_spacing );</a></li><li><a href="#_sub3" class="code">function linker = set_linker_endpos( linker, res_tag, relpos_field, at_start );</a></li><li><a href="#_sub4" class="code">function update_arrow( h, ctr, v, visible, spacing, add_stem );</a></li><li><a href="#_sub5" class="code">function linker = update_extra_arrows( linker, plot_pos, num_pos1, plot_settings );</a></li><li><a href="#_sub6" class="code">function pos1 = nudge_pos( pos1, pos2, bp_spacing );</a></li><li><a href="#_sub7" class="code">function plot_pos = get_plot_pos( res_tag, relpos );</a></li><li><a href="#_sub8" class="code">function update_symbol( h, pos, v, which_symbol, bp_spacing );</a></li><li><a href="#_sub9" class="code">function base_paired = check_for_base_pair( res_tag1, res_tag2 )</a></li><li><a href="#_sub10" class="code">function linker = update_tertiary_contact( linker, plot_pos, plot_settings );</a></li><li><a href="#_sub11" class="code">function linker = update_tertiary_arrow_label( linker, arrow_label, default_plot_pos, arrow_visible, plot_settings );</a></li><li><a href="#_sub12" class="code">function linker = update_outarrow( linker, plot_pos, residue, outarrow_size, outarrow_fieldname, outarrow_label_fieldname, arrow_visible, plot_settings, which_res )</a></li><li><a href="#_sub13" class="code">function  arrow_visible = check_first_linker_outarrow( linker, residue, arrow_visible );</a></li><li><a href="#_sub14" class="code">function check_interdomain( linker, plot_settings )</a></li><li><a href="#_sub15" class="code">function update_ligand_linker_visibility( linker, plot_settings );</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function linker = draw_linker( linker )</a>
0002 <span class="comment">% linker = draw_linker( linker )</span>
0003 <span class="comment">% linker = draw_linker( linkers )</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Draw the linker (arrow, stem_pair, noncanonical_pair, tertiary contact)</span>
0006 <span class="comment">%  including symbols.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Input:</span>
0009 <span class="comment">%  linker = Linker object (or tag string) to draw. Cell of multiple linkers is also OK.</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Output:</span>
0012 <span class="comment">%  linker = Linker object potentially with updated plot_pos or graphics handles</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% (C) R. Das, Stanford University, 2017</span>
0015 
0016 <span class="keyword">if</span> iscell( linker )
0017     <span class="keyword">for</span> i = 1:length( linker ); <a href="draw_linker.html" class="code" title="function linker = draw_linker( linker )">draw_linker</a>( linker{i} ); <span class="keyword">end</span>;
0018     <span class="keyword">return</span>;
0019 <span class="keyword">end</span>
0020 <span class="keyword">if</span> ischar( linker ) 
0021     <span class="keyword">if</span> isappdata( gca, linker ) 
0022         linker = getappdata( gca, linker );
0023     <span class="keyword">else</span>
0024         fprintf( <span class="string">'Could not find %s\n'</span>, linker );
0025         <span class="keyword">return</span>;
0026     <span class="keyword">end</span>
0027 <span class="keyword">end</span>;
0028 
0029 <span class="comment">% the rendering in this function  ends up being rate limiting for</span>
0030 <span class="comment">% draw_helix -- early return if we don't have to make anything</span>
0031 plot_settings = getappdata( gca, <span class="string">'plot_settings'</span> );
0032 <span class="keyword">if</span> ~isfield( linker, <span class="string">'line_handle'</span> )   
0033     residue1 = getappdata( gca, linker.residue1 );
0034     residue2 = getappdata( gca, linker.residue2 );
0035     <span class="keyword">if</span> ~isfield( residue1, <span class="string">'plot_pos'</span> ) <span class="keyword">return</span>; <span class="keyword">end</span>;
0036     <span class="keyword">if</span> ~isfield( residue2, <span class="string">'plot_pos'</span> ) <span class="keyword">return</span>; <span class="keyword">end</span>;
0037     <span class="keyword">if</span> strcmp(linker.type,<span class="string">'stack'</span> ) 
0038         <span class="keyword">if</span> ( norm( residue1.plot_pos - residue2.plot_pos ) &lt; 1.5 * plot_settings.bp_spacing ) <span class="keyword">return</span>; <span class="keyword">end</span>;
0039     <span class="keyword">end</span>
0040     <span class="keyword">if</span> strcmp(linker.type,<span class="string">'arrow'</span> ) 
0041         <span class="keyword">if</span> ( norm( residue1.plot_pos - residue2.plot_pos ) &lt; 1.5 * plot_settings.spacing ) <span class="keyword">return</span>; <span class="keyword">end</span>;
0042     <span class="keyword">end</span>
0043 <span class="keyword">end</span>
0044 <span class="keyword">if</span> strcmp(linker.type,<span class="string">'stack'</span> ) &amp;&amp; isfield( plot_settings, <span class="string">'show_stacks'</span>) &amp;&amp; ~plot_settings.show_stacks; <span class="keyword">return</span>; <span class="keyword">end</span>;
0045 <span class="keyword">if</span> strcmp(linker.type,<span class="string">'other_contact'</span> )&amp;&amp; isfield( plot_settings, <span class="string">'show_other_contacts'</span>) &amp;&amp; ~plot_settings.show_other_contacts; <span class="keyword">return</span>; <span class="keyword">end</span>;
0046     
0047 linker = <a href="#_sub1" class="code" title="subfunction linker = draw_default_linker( linker );">draw_default_linker</a>( linker );
0048    
0049 <span class="comment">% linker starts at res1 and ends at res2</span>
0050 linker = <a href="#_sub3" class="code" title="subfunction linker = set_linker_endpos( linker, res_tag, relpos_field, at_start );">set_linker_endpos</a>( linker, linker.residue1, <span class="string">'relpos1'</span>,  1 );
0051 linker = <a href="#_sub3" class="code" title="subfunction linker = set_linker_endpos( linker, res_tag, relpos_field, at_start );">set_linker_endpos</a>( linker, linker.residue2, <span class="string">'relpos2'</span>, -1 );
0052 
0053 <span class="comment">% figure out positions in figure frame, based on each residue's</span>
0054 <span class="comment">% helix frame:</span>
0055 plot_pos1 = <a href="#_sub7" class="code" title="subfunction plot_pos = get_plot_pos( res_tag, relpos );">get_plot_pos</a>( linker.residue1, linker.relpos1 );
0056 plot_pos2 = <a href="#_sub7" class="code" title="subfunction plot_pos = get_plot_pos( res_tag, relpos );">get_plot_pos</a>( linker.residue2, linker.relpos2 );
0057 plot_pos = [plot_pos1; plot_pos2 ];
0058 end_pos1 = plot_pos1(1,:);
0059 end_pos2 = plot_pos2(<span class="keyword">end</span>,:);
0060 
0061 <span class="keyword">if</span> isfield( linker, <span class="string">'arrow'</span> ) 
0062     <span class="comment">% hide linkers connecting consecutive residues if they are close</span>
0063     <span class="comment">% (this is a choice; could also show linker without arrow)</span>
0064     <span class="keyword">if</span> ( size( plot_pos, 1 ) == 2 &amp; <span class="keyword">...</span>
0065             norm( plot_pos(2,:) - plot_pos(1,:) ) &lt; 1.5*plot_settings.spacing );
0066         visible = <span class="string">'off'</span>; 
0067     <span class="keyword">else</span> 
0068         visible = <span class="string">'on'</span>; 
0069     <span class="keyword">end</span>;
0070     <span class="keyword">if</span> ( <a href="#_sub9" class="code" title="subfunction base_paired = check_for_base_pair( res_tag1, res_tag2 )">check_for_base_pair</a>( linker.residue1, linker.residue2 ) ) visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0071     set( linker.line_handle, <span class="string">'visible'</span>, visible); 
0072     <span class="keyword">if</span> isfield( linker, <span class="string">'vtx'</span> ); 
0073         vtx_visible = visible;
0074         <span class="keyword">if</span> ( isfield( plot_settings, <span class="string">'show_linker_controls'</span> ) &amp; ~plot_settings.show_linker_controls ) vtx_visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0075         <span class="keyword">for</span> i = 1:length( linker.vtx ), <span class="keyword">if</span> isvalid( linker.vtx{i} ); set( linker.vtx{i}, <span class="string">'visible'</span>, vtx_visible ); <span class="keyword">end</span>; <span class="keyword">end</span>;
0076     <span class="keyword">end</span>;
0077     residue1 = getappdata( gca, linker.residue1 );
0078     <span class="comment">% color setting</span>
0079     color = <span class="string">'k'</span>;  <span class="comment">%black is default</span>
0080     <span class="keyword">if</span> ( isfield( plot_settings, <span class="string">'color_arrows'</span> ) &amp; plot_settings.color_arrows &amp; isfield( residue1, <span class="string">'rgb_color'</span> ) ); color = residue1.rgb_color; <span class="keyword">end</span>
0081     set( linker.line_handle, <span class="string">'color'</span>,color);
0082     set( linker.arrow, <span class="string">'edgecolor'</span>,color );
0083     set( linker.arrow, <span class="string">'facecolor'</span>,color );
0084 <span class="keyword">elseif</span> strcmp( linker.type, <span class="string">'stack'</span> )  <span class="comment">% to guide the eye.</span>
0085     <span class="keyword">if</span> ( norm( plot_pos(<span class="keyword">end</span>,:) - plot_pos(1,:) ) &lt; 1.5 * plot_settings.bp_spacing ); visible = <span class="string">'off'</span>; <span class="keyword">else</span> visible = <span class="string">'on'</span>; <span class="keyword">end</span>;
0086     set( linker.line_handle, <span class="string">'visible'</span>, visible);
0087 <span class="keyword">end</span>
0088     
0089 <span class="comment">% nudge beginning and end of linker away from residue.</span>
0090 nudge_spacing = plot_settings.bp_spacing;
0091 <span class="keyword">if</span> isfield( getappdata( gca, linker.residue1 ), <span class="string">'ligand_partners'</span> ); nudge_spacing = nudge_spacing * 2; <span class="keyword">end</span>;
0092 plot_pos1(1,:)   = <a href="#_sub6" class="code" title="subfunction pos1 = nudge_pos( pos1, pos2, bp_spacing );">nudge_pos</a>( plot_pos(1,:),   plot_pos(2,:),     nudge_spacing );
0093 plot_pos2(<span class="keyword">end</span>,:) = <a href="#_sub6" class="code" title="subfunction pos1 = nudge_pos( pos1, pos2, bp_spacing );">nudge_pos</a>( plot_pos(<span class="keyword">end</span>,:), plot_pos(end-1,:), nudge_spacing );
0094 plot_pos(1,:)   = plot_pos1(1,:);
0095 plot_pos(<span class="keyword">end</span>,:) = plot_pos2(<span class="keyword">end</span>,:);
0096 linker.plot_pos = plot_pos;
0097 
0098 <span class="comment">% replot the line</span>
0099 <span class="keyword">if</span> ~isfield( linker, <span class="string">'line_handle'</span> ) ; <span class="keyword">return</span> ; <span class="keyword">end</span>
0100 set( linker.line_handle, <span class="string">'xdata'</span>, plot_pos(:,1), <span class="string">'ydata'</span>, plot_pos(:,2) );
0101 
0102 <span class="comment">% draw (draggable) vertices if they don't exist yet.</span>
0103 <span class="keyword">if</span> isfield( linker, <span class="string">'plot_pos'</span> ) 
0104     <span class="keyword">if</span> isfield( linker, <span class="string">'vtx'</span> ) 
0105         linker_vtx_ok = 1;
0106         <span class="keyword">for</span> i = 1:length( linker.vtx ); <span class="keyword">if</span> ~isvalid( linker.vtx{i} ); linker_vtx_ok = 0; <span class="keyword">break</span>; <span class="keyword">end</span>; <span class="keyword">end</span>;
0107         <span class="keyword">if</span> size(linker.plot_pos,1) ~= length( linker.vtx ) linker_vtx_ok = 0; <span class="keyword">end</span>;
0108         <span class="keyword">if</span> ~linker_vtx_ok
0109             <span class="keyword">for</span> i = 1:length( linker.vtx ); delete( linker.vtx{i} );  <span class="keyword">end</span>;
0110             linker = rmfield( linker, <span class="string">'vtx'</span> );
0111         <span class="keyword">end</span>
0112     <span class="keyword">end</span>
0113     <span class="keyword">if</span> ( ~isfield( linker, <span class="string">'vtx'</span> ) &amp; ~strcmp( linker.type, <span class="string">'stem_pair'</span> ) )                
0114         linker = <a href="create_linker_with_draggable_vtx.html" class="code" title="function linker = create_linker_with_draggable_vtx( linker )">create_linker_with_draggable_vtx</a>( linker );
0115         <span class="keyword">for</span> i = 1:size( linker.plot_pos, 1 )
0116             set( linker.vtx{i}, <span class="string">'xdata'</span>, linker.plot_pos(i,1), <span class="string">'ydata'</span>, linker.plot_pos(i,2) );
0117         <span class="keyword">end</span>
0118     <span class="keyword">end</span>
0119 <span class="keyword">end</span>
0120 
0121 <span class="comment">% place symbols on central segment</span>
0122 pos1 = plot_pos1( <span class="keyword">end</span>, : );
0123 pos2 = plot_pos2(   1, : );
0124 ctr = (pos1+pos2)/2; <span class="comment">% center of connecting line</span>
0125 v = pos2 - pos1; v = v/norm(v); <span class="comment">% unit vector from res1 to res2</span>
0126 num_pos1 = size(plot_pos1,1);
0127 <span class="keyword">if</span> isfield(linker,<span class="string">'arrow'</span>); <a href="#_sub4" class="code" title="subfunction update_arrow( h, ctr, v, visible, spacing, add_stem );">update_arrow</a>( linker.arrow, ctr, v, visible, plot_settings.spacing ); <span class="keyword">end</span>;
0128 <span class="keyword">if</span> isfield(linker,<span class="string">'arrow'</span>) &amp; isfield(plot_settings,<span class="string">'show_extra_arrows'</span>); linker = <a href="#_sub5" class="code" title="subfunction linker = update_extra_arrows( linker, plot_pos, num_pos1, plot_settings );">update_extra_arrows</a>( linker, plot_pos, num_pos1, plot_settings ); <span class="keyword">end</span>;
0129 <span class="keyword">if</span> isfield(linker,<span class="string">'symbol'</span>);  <a href="#_sub8" class="code" title="subfunction update_symbol( h, pos, v, which_symbol, bp_spacing );">update_symbol</a>( linker.symbol, ctr, v, 2, plot_settings.bp_spacing );  <span class="keyword">end</span>
0130 <span class="keyword">if</span> isfield(linker,<span class="string">'symbol1'</span>); <a href="#_sub8" class="code" title="subfunction update_symbol( h, pos, v, which_symbol, bp_spacing );">update_symbol</a>( linker.symbol1, ctr - (1.3*plot_settings.bp_spacing/10)*v, v, 1, plot_settings.bp_spacing );  <span class="keyword">end</span>;
0131 <span class="keyword">if</span> isfield(linker,<span class="string">'symbol2'</span>); <a href="#_sub8" class="code" title="subfunction update_symbol( h, pos, v, which_symbol, bp_spacing );">update_symbol</a>( linker.symbol2, ctr + (1.3*plot_settings.bp_spacing/10)*v, v, 2, plot_settings.bp_spacing );  <span class="keyword">end</span>
0132 <span class="keyword">if</span> isfield( linker, <span class="string">'node1'</span> ); <a href="#_sub8" class="code" title="subfunction update_symbol( h, pos, v, which_symbol, bp_spacing );">update_symbol</a>( linker.node1, end_pos1,v,1,plot_settings.bp_spacing*2.5 ); <span class="keyword">end</span>; 
0133 <span class="keyword">if</span> isfield( linker, <span class="string">'node2'</span> ); <a href="#_sub8" class="code" title="subfunction update_symbol( h, pos, v, which_symbol, bp_spacing );">update_symbol</a>( linker.node2, end_pos2,v,1,plot_settings.bp_spacing*2.5 ); <span class="keyword">end</span>; 
0134 <span class="keyword">if</span> isfield( linker, <span class="string">'tertiary_contact'</span> ); linker = <a href="#_sub10" class="code" title="subfunction linker = update_tertiary_contact( linker, plot_pos, plot_settings );">update_tertiary_contact</a>( linker, plot_pos, plot_settings ); <span class="keyword">end</span>;
0135 <span class="keyword">if</span> any(strcmp(linker.type, {<span class="string">'noncanonical_pair'</span>,<span class="string">'long_range_stem_pair'</span>} )) <a href="#_sub14" class="code" title="subfunction check_interdomain( linker, plot_settings )">check_interdomain</a>( linker, plot_settings ); <span class="keyword">end</span>;
0136 <span class="keyword">if</span> strcmp( linker.type, <span class="string">'ligand'</span> ) <a href="#_sub15" class="code" title="subfunction update_ligand_linker_visibility( linker, plot_settings );">update_ligand_linker_visibility</a>( linker, plot_settings ); <span class="keyword">end</span>;
0137 
0138 <span class="comment">% if there are vertex symbols at end points, re-draw them.</span>
0139 <span class="keyword">if</span> isfield( linker, <span class="string">'vtx'</span> )
0140     set( linker.vtx{1}  , <span class="string">'XData'</span>, plot_pos(1,1)  , <span class="string">'YData'</span>, plot_pos(1,2) );
0141     set( linker.vtx{end}, <span class="string">'XData'</span>, plot_pos(<span class="keyword">end</span>,1), <span class="string">'YData'</span>, plot_pos(<span class="keyword">end</span>,2) );
0142 <span class="keyword">end</span>
0143 
0144 setappdata( gca, linker.linker_tag, linker );
0145 
0146 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0147 <a name="_sub1" href="#_subfunctions" class="code">function linker = draw_default_linker( linker );</a>
0148 <span class="comment">% already drawn?</span>
0149 <span class="keyword">if</span> isfield( linker, <span class="string">'line_handle'</span> ) &amp; isvalid( linker.line_handle ); <span class="keyword">return</span>; <span class="keyword">end</span>;
0150 plot_settings = getappdata( gca, <span class="string">'plot_settings'</span> );
0151 <span class="keyword">switch</span> linker.type
0152     <span class="keyword">case</span> <span class="string">'stem_pair'</span>
0153         residue1 = getappdata( gca, linker.residue1 );
0154         residue2 = getappdata( gca, linker.residue2 );
0155         bp = [residue1.nucleotide,residue2.nucleotide];
0156         linker.line_handle = plot( [0,0],[0,0],<span class="string">'k'</span>,<span class="string">'linewidth'</span>,0.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0157         <span class="keyword">switch</span> bp
0158             <span class="keyword">case</span> {<span class="string">'AU'</span>,<span class="string">'UA'</span>,<span class="string">'GC'</span>,<span class="string">'CG'</span> } <span class="comment">% could also show double lines for G-C. Not my preference.</span>
0159                 set( linker.line_handle, <span class="string">'visible'</span>, <span class="string">'on'</span> );
0160             <span class="keyword">case</span> {<span class="string">'GU'</span>,<span class="string">'UG'</span>}
0161                 plot_settings = getappdata( gca, <span class="string">'plot_settings'</span> );
0162                 linker.symbol = <a href="create_LW_symbol.html" class="code" title="function h = create_LW_symbol( edge, orientation, bp_spacing );">create_LW_symbol</a>( <span class="string">'W'</span>, <span class="string">'C'</span>, plot_settings.bp_spacing );
0163                 set( linker.line_handle, <span class="string">'visible'</span>, <span class="string">'off'</span> ); <span class="comment">% convention for G*U in stems is to not show line.</span>
0164         <span class="keyword">end</span>
0165         setappdata( gca, linker.linker_tag, linker );
0166     <span class="keyword">case</span> { <span class="string">'noncanonical_pair'</span>, <span class="string">'long_range_stem_pair'</span> }
0167         linker.line_handle = plot( [0,0],[0,0],<span class="string">'k'</span>,<span class="string">'linewidth'</span>,0.5,<span class="string">'clipping'</span>,<span class="string">'off'</span>); <span class="comment">% dummy for now -- will get redrawn later.</span>
0168         <span class="keyword">if</span> ( linker.edge1 == linker.edge2 )
0169             linker.symbol = <a href="create_LW_symbol.html" class="code" title="function h = create_LW_symbol( edge, orientation, bp_spacing );">create_LW_symbol</a>( linker.edge1, linker.LW_orientation, plot_settings.bp_spacing );
0170         <span class="keyword">else</span>
0171             linker.symbol1 = <a href="create_LW_symbol.html" class="code" title="function h = create_LW_symbol( edge, orientation, bp_spacing );">create_LW_symbol</a>( linker.edge1, linker.LW_orientation, plot_settings.bp_spacing );
0172             linker.symbol2 = <a href="create_LW_symbol.html" class="code" title="function h = create_LW_symbol( edge, orientation, bp_spacing );">create_LW_symbol</a>( linker.edge2, linker.LW_orientation, plot_settings.bp_spacing );
0173         <span class="keyword">end</span>
0174         setappdata( gca, linker.linker_tag, linker );
0175     <span class="keyword">case</span> <span class="string">'arrow'</span>
0176         linker.line_handle = plot( [0,0],[0,0],<span class="string">'k'</span>,<span class="string">'linewidth'</span>,1.0,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0177         linker.arrow = patch( [0,0,0],[0,0,0],<span class="string">'k'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> );
0178         set( linker.line_handle, <span class="string">'linewidth'</span>, <a href="get_arrow_linewidth.html" class="code" title="function arrow_linewidth = get_arrow_linewidth( fontsize );">get_arrow_linewidth</a>( plot_settings.fontsize ) ); 
0179         setappdata( gca, linker.linker_tag, linker );
0180     <span class="keyword">case</span> <span class="string">'stack'</span>
0181         linker.line_handle = plot( [0,0],[0,0],<span class="string">'color'</span>,[0.8 0.8 0.8],<span class="string">'linestyle'</span>,<span class="string">':'</span>,<span class="string">'linewidth'</span>,1.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0182         setappdata( gca, linker.linker_tag, linker );
0183     <span class="keyword">case</span> <span class="string">'other_contact'</span>
0184         linker.line_handle = plot( [0,0],[0,0],<span class="string">'color'</span>,[0.5 0.5 1],<span class="string">'linestyle'</span>,<span class="string">':'</span>,<span class="string">'linewidth'</span>,5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0185         setappdata( gca, linker.linker_tag, linker );
0186     <span class="keyword">case</span> <span class="string">'ligand'</span>
0187         linker.line_handle = plot( [0,0],[0,0],<span class="string">'color'</span>,[0.8 0.8 0.8],<span class="string">'linestyle'</span>,<span class="string">'-'</span>,<span class="string">'linewidth'</span>,1.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0188         setappdata( gca, linker.linker_tag, linker );
0189         send_to_back( linker.line_handle );
0190     <span class="keyword">case</span> {<span class="string">'tertcontact_interdomain'</span>,<span class="string">'tertiary_contact_interdomain'</span>}
0191         linker.type = <span class="string">'tertcontact_interdomain'</span>;
0192         linker.line_handle = plot( [0,0],[0,0],<span class="string">'color'</span>,[0.8 0.8 0.8],<span class="string">'linestyle'</span>,<span class="string">'-'</span>,<span class="string">'linewidth'</span>,0.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0193         linker.node1 = <a href="#_sub2" class="code" title="subfunction h = create_undercircle( bp_spacing );">create_undercircle</a>( plot_settings.bp_spacing );
0194         linker.node2 = <a href="#_sub2" class="code" title="subfunction h = create_undercircle( bp_spacing );">create_undercircle</a>( plot_settings.bp_spacing );
0195         linker.side_line1 = patch( [0,0],[0,0],[0.8 0.8 0.8],<span class="string">'edgecolor'</span>,<span class="string">'none'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0196         linker.side_line2 = patch( [0,0],[0,0],[0.8 0.8 0.8],<span class="string">'edgecolor'</span>,<span class="string">'none'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0197         linker.outarrow1  = patch( [0,0],[0,0],[0.8 0.8 0.8],<span class="string">'edgecolor'</span>,<span class="string">'none'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0198         linker.outarrow2  = patch( [0,0],[0,0],[0.8 0.8 0.8],<span class="string">'edgecolor'</span>,<span class="string">'none'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0199         setappdata( gca, linker.linker_tag, linker );
0200         send_to_back( linker.line_handle );
0201         send_to_back( linker.side_line1 );
0202         send_to_back( linker.side_line2 );
0203         send_to_back( linker.outarrow1 );
0204         send_to_back( linker.outarrow2 );
0205     <span class="keyword">case</span> {<span class="string">'tertcontact_intradomain'</span>,<span class="string">'tertiary_contact_intradomain'</span>}
0206         linker.type = <span class="string">'tertcontact_intradomain'</span>;
0207         linker.line_handle = plot( [0,0],[0,0],<span class="string">'color'</span>,[0.8 0.8 0.8],<span class="string">'linestyle'</span>,<span class="string">'-'</span>,<span class="string">'linewidth'</span>,2.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0208         <span class="comment">% don't need to make node1 -- should be covered by interdomain.</span>
0209         linker.node2 = <a href="#_sub2" class="code" title="subfunction h = create_undercircle( bp_spacing );">create_undercircle</a>( plot_settings.bp_spacing );
0210         setappdata( gca, linker.linker_tag, linker );
0211         send_to_back( linker.line_handle );
0212 <span class="keyword">end</span>
0213 
0214 
0215 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0216 <a name="_sub2" href="#_subfunctions" class="code">function h = create_undercircle( bp_spacing );</a>
0217 t = linspace(0, 2*pi);
0218 r = bp_spacing/3;
0219 x = r*cos(t);
0220 y = r*sin(t);
0221 h = patch( x,y,<span class="string">'w'</span>,<span class="string">'edgecolor'</span>,[0.8,0.8,0.8],<span class="string">'facecolor'</span>,<span class="string">'w'</span>,<span class="string">'linewidth'</span>,2);
0222 send_to_back( h );
0223 
0224 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0225 <span class="comment">% Linkers (base pairs &amp; arrow connectors)</span>
0226 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0227 <a name="_sub3" href="#_subfunctions" class="code">function linker = set_linker_endpos( linker, res_tag, relpos_field, at_start );</a>
0228 <span class="keyword">if</span> ~isfield( linker, relpos_field )
0229     linker = setfield( linker, relpos_field, [0,0]);
0230 <span class="keyword">end</span>;
0231 relpos = getfield( linker, relpos_field );
0232 residue = getappdata( gca, res_tag );
0233 <span class="keyword">if</span> isfield( residue,<span class="string">'relpos'</span> )
0234     <span class="keyword">if</span> ( at_start &gt; 0) relpos(1,:)   = residue.relpos;
0235     <span class="keyword">else</span>               relpos(<span class="keyword">end</span>,:) = residue.relpos;
0236     <span class="keyword">end</span>
0237 <span class="keyword">end</span>
0238 linker = setfield( linker, relpos_field, relpos);
0239 setappdata( gca, linker.linker_tag, linker );
0240 
0241 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0242 <a name="_sub4" href="#_subfunctions" class="code">function update_arrow( h, ctr, v, visible, spacing, add_stem );</a>
0243 x = v * 1.5 * [0 1; -1 0]; <span class="comment">% cross direction</span>
0244 set( h, <span class="string">'visible'</span>, visible);
0245 a  = [ <span class="keyword">...</span>
0246     ctr - spacing/3*v+spacing/5*x;
0247     ctr - spacing/6*v+spacing/10*x;
0248     ctr + spacing*0*v+spacing/15*x;
0249     ctr + spacing/6*v+spacing/20*x;
0250     ctr + spacing/2*v;
0251     ctr + spacing/6*v-spacing/20*x;
0252     ctr - spacing*0*v-spacing/15*x;
0253     ctr - spacing/6*v-spacing/10*x;
0254     ctr - spacing/3*v-spacing/5*x <span class="keyword">...</span>
0255     ];
0256 <span class="keyword">if</span> exist( <span class="string">'add_stem'</span>, <span class="string">'var'</span> ) &amp; add_stem
0257     a = [ a; <span class="keyword">...</span>
0258         ctr - spacing/3*v-spacing*0.075*x; 
0259         ctr - spacing/2*v-spacing*0.075*x; 
0260         ctr - spacing/2*v+spacing*0.075*x; 
0261         ctr - spacing/3*v+spacing*0.075*x <span class="keyword">...</span>
0262         ];
0263 <span class="keyword">end</span>
0264     
0265 set( h, <span class="string">'xdata'</span>, <span class="keyword">...</span>
0266     a(:,1) );
0267 set( h, <span class="string">'ydata'</span>, <span class="keyword">...</span>
0268     a(:,2) );
0269 
0270 
0271 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0272 <a name="_sub5" href="#_subfunctions" class="code">function linker = update_extra_arrows( linker, plot_pos, num_pos1, plot_settings );</a>
0273 num_extra_arrows = size(plot_pos,1)-2;
0274 <span class="keyword">if</span> ~isfield( linker, <span class="string">'extra_arrows'</span> )
0275     linker.extra_arrows = {};
0276     <span class="keyword">for</span> i = 1:num_extra_arrows
0277         linker.extra_arrows{i} = patch( [0,0,0],[0,0,0],<span class="string">'k'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> );;
0278     <span class="keyword">end</span>
0279 <span class="keyword">end</span>
0280 
0281 <span class="comment">% make the right number of extra arrows</span>
0282 <span class="keyword">for</span> i = num_extra_arrows+1: length( linker.extra_arrows ); delete( linker.extra_arrows{i} ); <span class="keyword">end</span>
0283 <span class="keyword">for</span> i = length( linker.extra_arrows )+1 : num_extra_arrows;  linker.extra_arrows{i} = patch( [0,0,0],[0,0,0],<span class="string">'k'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="keyword">end</span>;
0284 linker.extra_arrows = linker.extra_arrows(1:num_extra_arrows);
0285 
0286 <span class="comment">% These are extra_arrows. Skip the 'usual' arrow that connects plot_pos1 and plot_pos2.</span>
0287 which_segment = [1:(num_pos1-1), (num_pos1+1):size(plot_pos,1)-1];
0288 assert( num_extra_arrows == length( which_segment) );
0289 <span class="keyword">for</span> i = 1:num_extra_arrows;
0290     pos1 = plot_pos( which_segment(i), : );
0291     pos2 = plot_pos( which_segment(i)+1, : );
0292     ctr = (pos1+pos2)/2; <span class="comment">% center of connecting line</span>
0293     v = pos2 - pos1; v = v/norm(v); <span class="comment">% unit vector from res1 to res2</span>
0294     show_arrow = plot_settings.show_extra_arrows &amp; norm( pos2 - pos1 ) &gt;= 5 * plot_settings.bp_spacing;
0295     <span class="keyword">if</span> ( show_arrow ) visible = <span class="string">'on'</span>; <span class="keyword">else</span>; visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0296     <a href="#_sub4" class="code" title="subfunction update_arrow( h, ctr, v, visible, spacing, add_stem );">update_arrow</a>( linker.extra_arrows{ i }, ctr, v, visible, plot_settings.spacing );
0297 <span class="keyword">end</span>
0298 
0299 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0300 <a name="_sub6" href="#_subfunctions" class="code">function pos1 = nudge_pos( pos1, pos2, bp_spacing );</a>
0301 v = pos2 - pos1; 
0302 v = v/norm(v);
0303 pos1 = pos1 +  (bp_spacing/5)*v;
0304 
0305 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0306 <a name="_sub7" href="#_subfunctions" class="code">function plot_pos = get_plot_pos( res_tag, relpos );</a>
0307 residue = getappdata( gca, res_tag );
0308 helix = getappdata( gca, residue.helix_tag );
0309 R = get_helix_rotation_matrix( helix );
0310 plot_pos = repmat(helix.center,size(relpos,1),1) + relpos*R;
0311 
0312 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0313 <a name="_sub8" href="#_subfunctions" class="code">function update_symbol( h, pos, v, which_symbol, bp_spacing );</a>
0314 vertices = get(h,<span class="string">'Vertices'</span>);
0315 numv = size(vertices,1);
0316 rot = atan2( v(2), v(1) ); <span class="comment">% rotate so that symbol 'aligns' with line.</span>
0317 <span class="keyword">if</span> which_symbol == 1; rot = rot + pi; <span class="keyword">end</span>;
0318 <span class="keyword">switch</span> numv
0319     <span class="keyword">case</span> 3 <span class="comment">% triangle</span>
0320         t = rot+[0 2*pi/3 2*pi*2/3];
0321         r = bp_spacing/10 * 1.5*sqrt(3)/2;
0322     <span class="keyword">case</span> 4 <span class="comment">% square</span>
0323         t = rot+[0 pi/2 pi 3*pi/2]+pi/4;
0324         r = bp_spacing/10 * sqrt(2);
0325     <span class="keyword">otherwise</span> <span class="comment">% circle</span>
0326         t = rot+linspace(0, 2*pi);
0327         r = bp_spacing/10;
0328 <span class="keyword">end</span>
0329 vertices = [r*cos(t); r*sin(t) ]' + repmat( pos, size(vertices,1), 1 );
0330 assert( numv == size( vertices, 1 ) );
0331 set( h, <span class="string">'xdata'</span>, vertices(:,1) );
0332 set( h, <span class="string">'ydata'</span>, vertices(:,2) );
0333 
0334 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0335 <a name="_sub9" href="#_subfunctions" class="code">function base_paired = check_for_base_pair( res_tag1, res_tag2 )</a>
0336 residue1 = getappdata( gca, res_tag1 );
0337 base_paired = false;
0338 <span class="keyword">for</span> i = 1:length( residue1.linkers )
0339     linker_tag = residue1.linkers{i};
0340     <span class="keyword">if</span> ~isappdata( gca, linker_tag ) fprintf( <span class="string">'Could not find linker %s\n'</span>, linker_tag ); <span class="keyword">continue</span>; <span class="keyword">end</span>;
0341     linker = getappdata( gca, linker_tag );
0342     <span class="keyword">if</span> strcmp( linker.type,<span class="string">'noncanonical_pair'</span> ) | strcmp( linker.type,<span class="string">'stem_pair'</span> )
0343         <span class="keyword">if</span> ( strcmp( linker.residue1 , res_tag1 ) &amp;&amp; strcmp( linker.residue2, res_tag2 ) ) 
0344             base_paired = true; <span class="keyword">return</span>;
0345         <span class="keyword">end</span>
0346         <span class="keyword">if</span> ( strcmp( linker.residue1 , res_tag2 ) &amp;&amp; strcmp( linker.residue2, res_tag1 ) ) 
0347             base_paired = true; <span class="keyword">return</span>;
0348         <span class="keyword">end</span>
0349     <span class="keyword">end</span>
0350 <span class="keyword">end</span>
0351 
0352 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0353 <a name="_sub10" href="#_subfunctions" class="code">function linker = update_tertiary_contact( linker, plot_pos, plot_settings );</a>
0354 tertiary_contact = getappdata( gca, linker.tertiary_contact );
0355     
0356 <span class="keyword">if</span> isfield( plot_settings, <span class="string">'show_tertiary_contacts'</span> )
0357     <span class="keyword">if</span> plot_settings.show_tertiary_contacts; visible = <span class="string">'on'</span>; <span class="keyword">else</span>; visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0358     linker = set_linker_visibility( linker, visible );
0359 <span class="keyword">end</span>
0360 
0361 residue1 = getappdata( gca, tertiary_contact.associated_residues1{1} );
0362 residue2 = getappdata( gca, tertiary_contact.associated_residues2{1} );
0363 
0364 <span class="keyword">if</span> strcmp( linker.type, <span class="string">'tertcontact_interdomain'</span> )
0365     <span class="comment">% double color lines for interdomain;</span>
0366     side_line1_pos = []; side_line2_pos = [];
0367     <span class="keyword">for</span> i = 1:length( plot_pos ) - 1
0368         segv = plot_pos(i+1,:) - plot_pos(i,:);
0369         segv = segv/norm(segv);
0370         segv = segv * [0 1; -1 0] * plot_settings.bp_spacing/8; <span class="comment">% rotate</span>
0371         side_line1_pos = [side_line1_pos; plot_pos(i,:)-segv; plot_pos(i+1,:)-segv ];
0372         side_line2_pos = [side_line2_pos; plot_pos(i,:)+segv; plot_pos(i+1,:)+segv ];
0373     <span class="keyword">end</span>
0374     set( linker.side_line1, <span class="string">'xdata'</span>, [side_line1_pos(:,1); plot_pos(end:-1:1,1)], <span class="string">'ydata'</span>, [side_line1_pos(:,2); plot_pos(end:-1:1,2)] );
0375     set( linker.side_line2, <span class="string">'xdata'</span>, [side_line2_pos(:,1); plot_pos(end:-1:1,1)], <span class="string">'ydata'</span>, [side_line2_pos(:,2); plot_pos(end:-1:1,2)] );
0376 
0377     <span class="keyword">if</span> ( isfield( linker, <span class="string">'show_split_arrows'</span> )  &amp;&amp; linker.show_split_arrows ) arrow_visible = <span class="string">'on'</span>; <span class="keyword">else</span>; arrow_visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0378     outarrow_size = 1.5*plot_settings.spacing;
0379     linker = <a href="#_sub12" class="code" title="subfunction linker = update_outarrow( linker, plot_pos, residue, outarrow_size, outarrow_fieldname, outarrow_label_fieldname, arrow_visible, plot_settings, which_res )">update_outarrow</a>( linker, plot_pos, residue1, outarrow_size,  <span class="string">'outarrow1'</span>,<span class="string">'outarrow_label1'</span>, arrow_visible, plot_settings, 1 );
0380     linker = <a href="#_sub12" class="code" title="subfunction linker = update_outarrow( linker, plot_pos, residue, outarrow_size, outarrow_fieldname, outarrow_label_fieldname, arrow_visible, plot_settings, which_res )">update_outarrow</a>( linker, plot_pos, residue2, outarrow_size,  <span class="string">'outarrow2'</span>,<span class="string">'outarrow_label2'</span>, arrow_visible, plot_settings, 2 );
0381     <span class="keyword">if</span> ( isfield( linker, <span class="string">'show_split_arrows'</span> )  &amp;&amp; linker.show_split_arrows &amp;&amp; isfield( plot_settings,<span class="string">'show_split_arrow_lines'</span>) )
0382         <span class="keyword">if</span> ( plot_settings.show_split_arrow_lines ) line_visible = <span class="string">'on'</span>; <span class="keyword">else</span>; line_visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0383         set( linker.line_handle, <span class="string">'visible'</span>,line_visible );
0384         <span class="keyword">if</span> isfield( linker, <span class="string">'vtx'</span> )
0385             vtx_visible = line_visible;
0386             <span class="keyword">if</span> isfield( plot_settings, <span class="string">'show_linker_controls'</span>) &amp; ~plot_settings.show_linker_controls;  vtx_visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0387             <span class="keyword">for</span> i = 1:length( linker.vtx ), set( linker.vtx{i}, <span class="string">'visible'</span>, vtx_visible ); <span class="keyword">end</span>;
0388         <span class="keyword">end</span>;
0389     <span class="keyword">end</span>
0390 <span class="keyword">end</span>
0391 
0392 <span class="comment">% colors</span>
0393 set( linker.line_handle, <span class="string">'xdata'</span>, plot_pos(:,1), <span class="string">'ydata'</span>, plot_pos(:,2) );
0394 
0395 <span class="keyword">if</span> isfield( residue1, <span class="string">'rgb_color'</span> ) rescolor1 = residue1.rgb_color; <span class="keyword">else</span>; rescolor1 = [0,0,0]; <span class="keyword">end</span>;
0396 <span class="keyword">if</span> isfield( residue2, <span class="string">'rgb_color'</span> ) rescolor2 = residue2.rgb_color; <span class="keyword">else</span>; rescolor2 = [0,0,0]; <span class="keyword">end</span>;
0397 <span class="comment">% make color informative about *other* domain</span>
0398 color1 = fade_color( rescolor2 );
0399 color2 = fade_color( rescolor1 );
0400 <span class="keyword">if</span> isfield(plot_settings,<span class="string">'tertiary_contact_domain_coloring'</span> ) &amp; ~plot_settings.tertiary_contact_domain_coloring
0401     color1 = [0.9 0.9 0.9];
0402     color2 = [0.9 0.9 0.9];
0403 <span class="keyword">end</span>
0404 <span class="keyword">if</span> strcmp( linker.type, <span class="string">'tertcontact_interdomain'</span> )
0405     set( linker.node1, <span class="string">'edgecolor'</span>,color1);
0406     set( linker.node2, <span class="string">'edgecolor'</span>,color2);
0407     set( linker.side_line1, <span class="string">'facecolor'</span>, color1 );
0408     set( linker.side_line2, <span class="string">'facecolor'</span>, color2 );
0409     <span class="keyword">if</span> isfield( linker, <span class="string">'outarrow1'</span> ); set( linker.outarrow1, <span class="string">'facecolor'</span>,rescolor2 ); <span class="keyword">end</span>;  
0410     <span class="keyword">if</span> isfield( linker, <span class="string">'outarrow2'</span> ); set( linker.outarrow2, <span class="string">'facecolor'</span>,rescolor1 ); <span class="keyword">end</span>;
0411     <span class="keyword">if</span> isfield( linker, <span class="string">'outarrow_label1'</span> ); set( linker.outarrow_label1, <span class="string">'color'</span>,rescolor2 ); <span class="keyword">end</span>;  
0412     <span class="keyword">if</span> isfield( linker, <span class="string">'outarrow_label2'</span> ); set( linker.outarrow_label2, <span class="string">'color'</span>,rescolor1 ); <span class="keyword">end</span>;
0413     linker_visible = get(linker.node1,<span class="string">'visible'</span>);
0414     <span class="keyword">if</span> isfield( linker, <span class="string">'show_split_arrows'</span> ) &amp; linker.show_split_arrows
0415         set( linker.outarrow1, <span class="string">'visible'</span>, linker_visible );
0416         set( linker.outarrow2, <span class="string">'visible'</span>, linker_visible );
0417         set( linker.side_line1, <span class="string">'visible'</span>,<span class="string">'off'</span>);
0418         set( linker.side_line2, <span class="string">'visible'</span>,<span class="string">'off'</span>);
0419     <span class="keyword">else</span>
0420         set( linker.outarrow1, <span class="string">'visible'</span>, <span class="string">'off'</span> );
0421         set( linker.outarrow2, <span class="string">'visible'</span>, <span class="string">'off'</span> );
0422         set( linker.side_line1, <span class="string">'visible'</span>,linker_visible );
0423         set( linker.side_line2, <span class="string">'visible'</span>,linker_visible );
0424     <span class="keyword">end</span>
0425 <span class="keyword">else</span>
0426     assert( strcmp( linker.type, <span class="string">'tertcontact_intradomain'</span> ) );
0427     set( linker.line_handle, <span class="string">'linewidth'</span>, 2*<a href="get_arrow_linewidth.html" class="code" title="function arrow_linewidth = get_arrow_linewidth( fontsize );">get_arrow_linewidth</a>( plot_settings.fontsize ) );
0428     <span class="keyword">if</span> any( strcmp( tertiary_contact.associated_residues1, linker.residue1 ) ) <span class="comment">% in domain 1</span>
0429         set( linker.node2, <span class="string">'edgecolor'</span>,color1);
0430         set( linker.line_handle, <span class="string">'color'</span>,color1);
0431     <span class="keyword">else</span> <span class="comment">% in domain 2</span>
0432         assert( any( strcmp( tertiary_contact.associated_residues2, linker.residue1 ) ) );
0433         set( linker.node2, <span class="string">'edgecolor'</span>,color2);
0434         set( linker.line_handle, <span class="string">'color'</span>,color2);
0435     <span class="keyword">end</span>
0436 <span class="keyword">end</span>
0437 
0438 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0439 <a name="_sub11" href="#_subfunctions" class="code">function linker = update_tertiary_arrow_label( linker, arrow_label, default_plot_pos, arrow_visible, plot_settings );</a>
0440 <span class="keyword">if</span> ~isfield( linker, arrow_label )
0441     h = text( 0, 0, <span class="string">'.'</span> );
0442     linker = setfield( linker, arrow_label, h );
0443     setappdata( gca, linker.linker_tag, linker );
0444 <span class="keyword">end</span>
0445 tertiary_contact = getappdata( gca, linker.tertiary_contact );
0446 h = getfield(linker, arrow_label);
0447 set( h, <span class="string">'string'</span>, strrep(tertiary_contact.name,<span class="string">'_'</span>,<span class="string">'-'</span>), <span class="string">'Position'</span>, default_plot_pos, <span class="string">'visible'</span>,arrow_visible,<span class="string">'fontsize'</span>, plot_settings.fontsize*0.75 );
0448 
0449 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0450 <a name="_sub12" href="#_subfunctions" class="code">function linker = update_outarrow( linker, plot_pos, residue, outarrow_size, outarrow_fieldname, outarrow_label_fieldname, arrow_visible, plot_settings, which_res )</a>
0451 
0452 <span class="keyword">if</span> ~isfield( linker, outarrow_fieldname ) <span class="keyword">return</span>; <span class="keyword">end</span>;
0453 
0454 <span class="comment">% if this is the ligand side of an interdomain outarrow,</span>
0455 <span class="comment">% only show arrow if its the first split one.</span>
0456 <span class="keyword">if</span> which_res == 1 &amp;&amp; isfield( residue, <span class="string">'ligand_partners'</span> ) arrow_visible = <a href="#_sub13" class="code" title="subfunction  arrow_visible = check_first_linker_outarrow( linker, residue, arrow_visible );">check_first_linker_outarrow</a>( linker, residue, arrow_visible ); <span class="keyword">end</span>;
0457 
0458 <span class="keyword">if</span> ( which_res == 2 ) plot_pos = plot_pos(end:-1:1,:); <span class="keyword">end</span>;
0459 <span class="keyword">if</span> isfield( residue, <span class="string">'image_handle'</span> )
0460     [v,start_pos,pointing_out_of_polygon] = <a href="first_crossing.html" class="code" title="function [v,start_pos,pointing_out_of_polygon] = first_crossing( polygon, plot_pos );">first_crossing</a>( [get(residue.image_handle,<span class="string">'XData'</span>),get(residue.image_handle,<span class="string">'YData'</span>)], plot_pos );
0461     <span class="keyword">if</span> ( ~pointing_out_of_polygon ) arrow_visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0462 <span class="keyword">else</span>
0463     v = plot_pos(2,:) - plot_pos(1,:);  v = v /norm(v);
0464     start_pos = plot_pos(1,:);
0465 <span class="keyword">end</span>
0466 <a href="#_sub4" class="code" title="subfunction update_arrow( h, ctr, v, visible, spacing, add_stem );">update_arrow</a>( getfield(linker,outarrow_fieldname), start_pos + v*outarrow_size*0.5, v, arrow_visible, outarrow_size, 1 );
0467 linker = <a href="#_sub11" class="code" title="subfunction linker = update_tertiary_arrow_label( linker, arrow_label, default_plot_pos, arrow_visible, plot_settings );">update_tertiary_arrow_label</a>( linker, outarrow_label_fieldname, start_pos + v*outarrow_size, arrow_visible, plot_settings );
0468 set_text_alignment( getfield( linker, outarrow_label_fieldname ), v );
0469 
0470 
0471 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0472 <a name="_sub13" href="#_subfunctions" class="code">function  arrow_visible = check_first_linker_outarrow( linker, residue, arrow_visible );</a>
0473 sister_linker_tags = get_tags( <span class="string">'Linker'</span>,<span class="string">'interdomain'</span>,residue.linkers );
0474 <span class="keyword">for</span> i = 1:length( sister_linker_tags )
0475     sister_linker = getappdata( gca, sister_linker_tags{i} );
0476     <span class="keyword">if</span> ~isfield( sister_linker, <span class="string">'show_split_arrows'</span> ) || ~sister_linker.show_split_arrows; <span class="keyword">continue</span>; <span class="keyword">end</span>
0477     <span class="keyword">if</span> ~strcmp(sister_linker.linker_tag,linker.linker_tag);
0478         arrow_visible = <span class="string">'off'</span>;
0479     <span class="keyword">end</span>
0480     <span class="keyword">return</span>;
0481 <span class="keyword">end</span>
0482 
0483 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0484 <a name="_sub14" href="#_subfunctions" class="code">function check_interdomain( linker, plot_settings )</a>
0485 <span class="comment">% for show/hide interdomain_noncanonical_pairs</span>
0486 <span class="keyword">if</span> ~isfield( plot_settings, <span class="string">'show_interdomain_noncanonical_pairs'</span> ) <span class="keyword">return</span>; <span class="keyword">end</span>;
0487 setting = 1;
0488 <span class="keyword">if</span> ~plot_settings.show_interdomain_noncanonical_pairs
0489     <span class="keyword">if</span> isfield( linker, <span class="string">'interdomain'</span> ) &amp; linker.interdomain
0490         setting = 0;
0491     <span class="keyword">end</span>
0492 <span class="keyword">end</span>
0493 <span class="keyword">if</span> setting; visible = <span class="string">'on'</span>; <span class="keyword">else</span>; visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0494 linker = set_linker_visibility( linker, visible );
0495 
0496 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0497 <a name="_sub15" href="#_subfunctions" class="code">function update_ligand_linker_visibility( linker, plot_settings );</a>
0498 <span class="keyword">if</span> ~isfield( plot_settings, <span class="string">'show_ligand_linkers'</span> ); <span class="keyword">return</span>; <span class="keyword">end</span>;
0499 <span class="keyword">if</span> ( plot_settings.show_ligand_linkers ) visible = <span class="string">'on'</span>; <span class="keyword">else</span>; visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0500 set( linker.line_handle, <span class="string">'visible'</span>, visible );
0501 
0502     
0503</pre></div>
<hr><address>Generated on Fri 24-Nov-2017 17:23:44 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>