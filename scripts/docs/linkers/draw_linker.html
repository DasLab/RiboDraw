<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of draw_linker</title>
  <meta name="keywords" content="draw_linker">
  <meta name="description" content="linker = draw_linker( linker )">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html linkers -->
<h1>draw_linker
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>linker = draw_linker( linker )</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function linker = draw_linker( linker, plot_settings ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> linker = draw_linker( linker )
 linker = draw_linker( linkers )

 Draw the linker (arrow, stem_pair, noncanonical_pair, tertiary contact)
  including symbols.

 Input:
  linker = Linker object (or tag string) to draw. Cell of multiple linkers is also OK.
  plot_settings = [optional] plot settings (if not supplied, funciton will
                       infer from current axes)

 Output:
  linker = Linker object potentially with updated plot_pos or graphics handles

 (C) R. Das, Stanford University, 2017</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="create_LW_symbol.html" class="code" title="function h = create_LW_symbol( edge, orientation, bp_spacing );">create_LW_symbol</a>	h = create_LW_symbol( edge, orientation, bp_spacing );</li><li><a href="create_linker_with_draggable_vtx.html" class="code" title="function linker = create_linker_with_draggable_vtx( linker )">create_linker_with_draggable_vtx</a>	linker = create_linker_with_draggable_vtx( linker )</li><li><a href="delete_linker.html" class="code" title="function linker = delete_linker( linker, remove_linker );">delete_linker</a>	linker = delete_linker( linker, remove_linker )</li><li><a href="draw_linker.html" class="code" title="function linker = draw_linker( linker, plot_settings )">draw_linker</a>	linker = draw_linker( linker )</li><li><a href="first_crossing.html" class="code" title="function [v,start_pos,pointing_out_of_polygon] = first_crossing( polygon, plot_pos );">first_crossing</a>	first_crossing( polygon, plot_pos );</li><li><a href="get_arrow_linewidth.html" class="code" title="function arrow_linewidth = get_arrow_linewidth( fontsize );">get_arrow_linewidth</a>	arrow_linewidth = get_arrow_linewidth( fontsize );</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="autotrace_intradomain_linker.html" class="code" title="function linker = autotrace_intradomain_linker( linker );">autotrace_intradomain_linker</a>	autotrace_intradomain_linker( linker );</li><li><a href="autotrace_linker.html" class="code" title="function linker = autotrace_linker( linker );">autotrace_linker</a>	autotrace_linker( linker );</li><li><a href="create_linker_with_draggable_vtx.html" class="code" title="function linker = create_linker_with_draggable_vtx( linker )">create_linker_with_draggable_vtx</a>	linker = create_linker_with_draggable_vtx( linker )</li><li><a href="draw_linker.html" class="code" title="function linker = draw_linker( linker, plot_settings )">draw_linker</a>	linker = draw_linker( linker )</li><li><a href="rectify_linker.html" class="code" title="function linker = rectify_linker( linker, overwrite );">rectify_linker</a>	linker = rectify_linker();</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function linker = draw_default_linker( linker );</a></li><li><a href="#_sub2" class="code">function h = create_undercircle( bp_spacing );</a></li><li><a href="#_sub3" class="code">function too_short = linker_is_too_short_for_display( linker, plot_settings )</a></li><li><a href="#_sub4" class="code">function linker = set_linker_endpos( linker, res_tag, relpos_field, at_start );</a></li><li><a href="#_sub5" class="code">function update_arrow( h, ctr, v, spacing, add_stem );</a></li><li><a href="#_sub6" class="code">function linker = update_arrow_style( linker, plot_settings )</a></li><li><a href="#_sub7" class="code">function linker = update_extra_arrows( linker, plot_pos, num_pos1, plot_settings );</a></li><li><a href="#_sub8" class="code">function pos1 = nudge_pos( pos1, pos2, bp_spacing );</a></li><li><a href="#_sub9" class="code">function update_symbol( h, pos, v, which_symbol, bp_spacing );</a></li><li><a href="#_sub10" class="code">function base_paired = check_for_base_pair( res_tag1, res_tag2 )</a></li><li><a href="#_sub11" class="code">function linker = update_tertiary_contact( linker, plot_pos, plot_settings );</a></li><li><a href="#_sub12" class="code">function linker = update_tertiary_arrow_label( linker, arrow_label, default_plot_pos, arrow_visible, plot_settings );</a></li><li><a href="#_sub13" class="code">function linker = update_outarrow( linker, plot_pos, residue, outarrow_size, outarrow_fieldname, outarrow_label_fieldname, arrow_visible, plot_settings, which_res )</a></li><li><a href="#_sub14" class="code">function  arrow_visible = check_first_linker_outarrow( linker, residue, arrow_visible );</a></li><li><a href="#_sub15" class="code">function setting = show_tertiary_noncanonical_pair( linker, plot_settings )</a></li><li><a href="#_sub16" class="code">function update_ligand_linker( linker, plot_settings );</a></li><li><a href="#_sub17" class="code">function linecolor = get_single_color_for_ligand_linker( residue1, residue2 );</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function linker = draw_linker( linker, plot_settings )</a>
0002 <span class="comment">% linker = draw_linker( linker )</span>
0003 <span class="comment">% linker = draw_linker( linkers )</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Draw the linker (arrow, stem_pair, noncanonical_pair, tertiary contact)</span>
0006 <span class="comment">%  including symbols.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Input:</span>
0009 <span class="comment">%  linker = Linker object (or tag string) to draw. Cell of multiple linkers is also OK.</span>
0010 <span class="comment">%  plot_settings = [optional] plot settings (if not supplied, funciton will</span>
0011 <span class="comment">%                       infer from current axes)</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Output:</span>
0014 <span class="comment">%  linker = Linker object potentially with updated plot_pos or graphics handles</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% (C) R. Das, Stanford University, 2017</span>
0017 
0018 <span class="keyword">if</span> ~exist( <span class="string">'plot_settings'</span>,<span class="string">'var'</span> ) plot_settings = getappdata( gca, <span class="string">'plot_settings'</span> ); <span class="keyword">end</span>
0019 <span class="keyword">if</span> iscell( linker )
0020     <span class="keyword">for</span> i = 1:length( linker ); <a href="draw_linker.html" class="code" title="function linker = draw_linker( linker, plot_settings )">draw_linker</a>( linker{i}, plot_settings ); <span class="keyword">end</span>
0021     <span class="keyword">return</span>;
0022 <span class="keyword">end</span>
0023 <span class="keyword">if</span> ischar( linker ) 
0024     <span class="keyword">if</span> isappdata( gca, linker ) 
0025         linker = getappdata( gca, linker );
0026     <span class="keyword">else</span>
0027         fprintf( <span class="string">'Could not find %s\n'</span>, linker );
0028         <span class="keyword">return</span>;
0029     <span class="keyword">end</span>
0030 <span class="keyword">end</span>;
0031 
0032 <span class="comment">% the rendering in this function  ends up being rate limiting for</span>
0033 <span class="comment">% draw_helix -- early return (and delete the linker graphics!) if we don't have to make anything</span>
0034 toggle_types    = {<span class="string">'stack'</span>,      <span class="string">'other_contact'</span>,      <span class="string">'noncanonical_pair'</span>,      <span class="string">'stem_pair'</span>,      <span class="string">'long_range_stem_pair'</span>,<span class="string">'ligand'</span>,             <span class="string">'tertcontact_intradomain'</span>,<span class="string">'tertcontact_interdomain'</span> };
0035 toggle_settings = {<span class="string">'show_stacks'</span>,<span class="string">'show_other_contacts'</span>,<span class="string">'show_noncanonical_pairs'</span>,<span class="string">'show_stem_pairs'</span>,<span class="string">'show_stem_pairs'</span>,     <span class="string">'show_ligand_linkers'</span>,<span class="string">'show_tertiary_contacts'</span>, <span class="string">'show_tertiary_contacts'</span>};
0036 <span class="keyword">for</span> i = 1:length(toggle_types)
0037     <span class="keyword">if</span> strcmp(linker.type,toggle_types{i}) &amp;&amp; isfield( plot_settings, toggle_settings{i} ) &amp;&amp; ~getfield(plot_settings,toggle_settings{i}) 
0038         <span class="keyword">if</span> isfield(linker,<span class="string">'line_handle'</span>); linker = <a href="delete_linker.html" class="code" title="function linker = delete_linker( linker, remove_linker );">delete_linker</a>( linker, 0 ); <span class="keyword">end</span>;
0039         <span class="keyword">return</span>;
0040     <span class="keyword">end</span>;
0041 <span class="keyword">end</span>
0042 <span class="keyword">if</span> <a href="#_sub3" class="code" title="subfunction too_short = linker_is_too_short_for_display( linker, plot_settings )">linker_is_too_short_for_display</a>( linker, plot_settings ); linker = <a href="delete_linker.html" class="code" title="function linker = delete_linker( linker, remove_linker );">delete_linker</a>( linker, 0 );  <span class="keyword">return</span>; <span class="keyword">end</span>;
0043 <span class="keyword">if</span> ( strcmp( linker.type, <span class="string">'arrow'</span> ) &amp;&amp; <a href="#_sub10" class="code" title="subfunction base_paired = check_for_base_pair( res_tag1, res_tag2 )">check_for_base_pair</a>( linker.residue1, linker.residue2 ) ); linker = <a href="delete_linker.html" class="code" title="function linker = delete_linker( linker, remove_linker );">delete_linker</a>( linker, 0 ); <span class="keyword">return</span>; <span class="keyword">end</span>;
0044 <span class="keyword">if</span> strcmp(linker.type, {<span class="string">'noncanonical_pair'</span>} ) &amp;&amp; ~<a href="#_sub15" class="code" title="subfunction setting = show_tertiary_noncanonical_pair( linker, plot_settings )">show_tertiary_noncanonical_pair</a>( linker, plot_settings ); linker = <a href="delete_linker.html" class="code" title="function linker = delete_linker( linker, remove_linker );">delete_linker</a>( linker, 0 ); <span class="keyword">return</span>; <span class="keyword">end</span>;
0045 
0046 <span class="comment">% linker starts at res1 and ends at res2</span>
0047 linker = <a href="#_sub4" class="code" title="subfunction linker = set_linker_endpos( linker, res_tag, relpos_field, at_start );">set_linker_endpos</a>( linker, linker.residue1, <span class="string">'relpos1'</span>,  1 );
0048 linker = <a href="#_sub4" class="code" title="subfunction linker = set_linker_endpos( linker, res_tag, relpos_field, at_start );">set_linker_endpos</a>( linker, linker.residue2, <span class="string">'relpos2'</span>, -1 );
0049 <span class="comment">% figure out positions in figure frame, based on each residue's</span>
0050 <span class="comment">% helix frame:</span>
0051 plot_pos1 = get_plot_pos( linker.residue1, linker.relpos1 );
0052 plot_pos2 = get_plot_pos( linker.residue2, linker.relpos2 );
0053 plot_pos = [plot_pos1; plot_pos2 ];
0054 end_pos1 = plot_pos1(1,:);
0055 end_pos2 = plot_pos2(<span class="keyword">end</span>,:);
0056 
0057 linker = <a href="#_sub1" class="code" title="subfunction linker = draw_default_linker( linker );">draw_default_linker</a>( linker );
0058     
0059 <span class="comment">% nudge beginning and end of linker away from residue.</span>
0060 nudge_spacing = plot_settings.bp_spacing;
0061 <span class="keyword">if</span> isfield( getappdata( gca, linker.residue1 ), <span class="string">'ligand_partners'</span> ); nudge_spacing = nudge_spacing * 2; <span class="keyword">end</span>;
0062 plot_pos1(1,:)   = <a href="#_sub8" class="code" title="subfunction pos1 = nudge_pos( pos1, pos2, bp_spacing );">nudge_pos</a>( plot_pos(1,:),   plot_pos(2,:),     nudge_spacing );
0063 plot_pos2(<span class="keyword">end</span>,:) = <a href="#_sub8" class="code" title="subfunction pos1 = nudge_pos( pos1, pos2, bp_spacing );">nudge_pos</a>( plot_pos(<span class="keyword">end</span>,:), plot_pos(end-1,:), nudge_spacing );
0064 plot_pos(1,:)   = plot_pos1(1,:);
0065 plot_pos(<span class="keyword">end</span>,:) = plot_pos2(<span class="keyword">end</span>,:);
0066 linker.plot_pos = plot_pos;
0067 
0068 <span class="comment">% replot the line</span>
0069 <span class="keyword">if</span> ~isfield( linker, <span class="string">'line_handle'</span> ) ; <span class="keyword">return</span> ; <span class="keyword">end</span>
0070 set( linker.line_handle, <span class="string">'xdata'</span>, plot_pos(:,1), <span class="string">'ydata'</span>, plot_pos(:,2) );
0071 
0072 <span class="comment">% draw (draggable) vertices if they don't exist yet.</span>
0073 <span class="keyword">if</span> isfield( linker, <span class="string">'plot_pos'</span> ) 
0074     <span class="keyword">if</span> isfield( linker, <span class="string">'vtx'</span> ) 
0075         linker_vtx_ok = plot_settings.show_linker_controls;
0076         <span class="keyword">for</span> i = 1:length( linker.vtx ); <span class="keyword">if</span> ~isvalid( linker.vtx{i} ); linker_vtx_ok = 0; <span class="keyword">break</span>; <span class="keyword">end</span>; <span class="keyword">end</span>;
0077         <span class="keyword">if</span> size(linker.plot_pos,1) ~= length( linker.vtx ) linker_vtx_ok = 0; <span class="keyword">end</span>;
0078         <span class="keyword">if</span> ~linker_vtx_ok
0079             <span class="keyword">for</span> i = 1:length( linker.vtx ); delete( linker.vtx{i} );  <span class="keyword">end</span>;
0080             linker = rmfield( linker, <span class="string">'vtx'</span> );
0081         <span class="keyword">end</span>
0082     <span class="keyword">end</span>
0083     <span class="keyword">if</span> ( ~isfield( linker, <span class="string">'vtx'</span> ) &amp;&amp; ~strcmp( linker.type, <span class="string">'stem_pair'</span> ) &amp;&amp; plot_settings.show_linker_controls  )                
0084         linker = <a href="create_linker_with_draggable_vtx.html" class="code" title="function linker = create_linker_with_draggable_vtx( linker )">create_linker_with_draggable_vtx</a>( linker );
0085     <span class="keyword">end</span>  
0086     <span class="keyword">if</span> (isfield( linker, <span class="string">'vtx'</span> ) )
0087         <span class="keyword">for</span> i = 1:size( linker.plot_pos, 1 )
0088             set( linker.vtx{i}, <span class="string">'xdata'</span>, linker.plot_pos(i,1), <span class="string">'ydata'</span>, linker.plot_pos(i,2) );
0089         <span class="keyword">end</span>
0090     <span class="keyword">end</span>
0091 <span class="keyword">end</span>
0092 
0093 <span class="comment">% place symbols on central segment</span>
0094 pos1 = plot_pos1( <span class="keyword">end</span>, : );
0095 pos2 = plot_pos2(   1, : );
0096 ctr = (pos1+pos2)/2; <span class="comment">% center of connecting line</span>
0097 v = pos2 - pos1; v = v/norm(v); <span class="comment">% unit vector from res1 to res2</span>
0098 num_pos1 = size(plot_pos1,1);
0099 <span class="keyword">if</span> isfield(linker,<span class="string">'arrow'</span>); linker = <a href="#_sub6" class="code" title="subfunction linker = update_arrow_style( linker, plot_settings )">update_arrow_style</a>( linker, plot_settings ); <span class="keyword">end</span>;
0100 <span class="keyword">if</span> isfield(linker,<span class="string">'arrow'</span>); <a href="#_sub5" class="code" title="subfunction update_arrow( h, ctr, v, spacing, add_stem );">update_arrow</a>( linker.arrow, ctr, v, plot_settings.spacing ); <span class="keyword">end</span>;
0101 <span class="keyword">if</span> isfield(linker,<span class="string">'arrow'</span>) &amp; isfield(plot_settings,<span class="string">'show_extra_arrows'</span>); linker = <a href="#_sub7" class="code" title="subfunction linker = update_extra_arrows( linker, plot_pos, num_pos1, plot_settings );">update_extra_arrows</a>( linker, plot_pos, num_pos1, plot_settings ); <span class="keyword">end</span>;
0102 <span class="keyword">if</span> isfield(linker,<span class="string">'symbol'</span>);  <a href="#_sub9" class="code" title="subfunction update_symbol( h, pos, v, which_symbol, bp_spacing );">update_symbol</a>( linker.symbol, ctr, v, 2, plot_settings.bp_spacing );  <span class="keyword">end</span>
0103 <span class="keyword">if</span> isfield(linker,<span class="string">'symbol1'</span>); <a href="#_sub9" class="code" title="subfunction update_symbol( h, pos, v, which_symbol, bp_spacing );">update_symbol</a>( linker.symbol1, ctr - (1.3*plot_settings.bp_spacing/10)*v, v, 1, plot_settings.bp_spacing );  <span class="keyword">end</span>;
0104 <span class="keyword">if</span> isfield(linker,<span class="string">'symbol2'</span>); <a href="#_sub9" class="code" title="subfunction update_symbol( h, pos, v, which_symbol, bp_spacing );">update_symbol</a>( linker.symbol2, ctr + (1.3*plot_settings.bp_spacing/10)*v, v, 2, plot_settings.bp_spacing );  <span class="keyword">end</span>
0105 <span class="keyword">if</span> isfield( linker, <span class="string">'node1'</span> ); <a href="#_sub9" class="code" title="subfunction update_symbol( h, pos, v, which_symbol, bp_spacing );">update_symbol</a>( linker.node1, end_pos1,v,1,plot_settings.bp_spacing*3 ); <span class="keyword">end</span>; 
0106 <span class="keyword">if</span> isfield( linker, <span class="string">'node2'</span> ); <a href="#_sub9" class="code" title="subfunction update_symbol( h, pos, v, which_symbol, bp_spacing );">update_symbol</a>( linker.node2, end_pos2,v,1,plot_settings.bp_spacing*3 ); <span class="keyword">end</span>; 
0107 <span class="keyword">if</span> any(strcmp(linker.type, {<span class="string">'tertcontact_interdomain'</span>,<span class="string">'tertcontact_intradomain'</span>} )); linker = <a href="#_sub11" class="code" title="subfunction linker = update_tertiary_contact( linker, plot_pos, plot_settings );">update_tertiary_contact</a>( linker, plot_pos, plot_settings ); <span class="keyword">end</span>;
0108 <span class="keyword">if</span> strcmp( linker.type, <span class="string">'ligand'</span> ) <a href="#_sub16" class="code" title="subfunction update_ligand_linker( linker, plot_settings );">update_ligand_linker</a>( linker, plot_settings ); <span class="keyword">end</span>;
0109 
0110 <span class="comment">% if there are vertex symbols at end points, re-draw them.</span>
0111 <span class="keyword">if</span> isfield( linker, <span class="string">'vtx'</span> )
0112     set( linker.vtx{1}  , <span class="string">'XData'</span>, plot_pos(1,1)  , <span class="string">'YData'</span>, plot_pos(1,2) );
0113     set( linker.vtx{end}, <span class="string">'XData'</span>, plot_pos(<span class="keyword">end</span>,1), <span class="string">'YData'</span>, plot_pos(<span class="keyword">end</span>,2) );
0114 <span class="keyword">end</span>
0115 
0116 setappdata( gca, linker.linker_tag, linker );
0117 
0118 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0119 <a name="_sub1" href="#_subfunctions" class="code">function linker = draw_default_linker( linker );</a>
0120 <span class="comment">% already drawn?</span>
0121 <span class="keyword">if</span> isfield( linker, <span class="string">'line_handle'</span> ) &amp; isvalid( linker.line_handle ); <span class="keyword">return</span>; <span class="keyword">end</span>;
0122 plot_settings = getappdata( gca, <span class="string">'plot_settings'</span> );
0123 <span class="keyword">switch</span> linker.type
0124     <span class="keyword">case</span> <span class="string">'stem_pair'</span>
0125         residue1 = getappdata( gca, linker.residue1 );
0126         residue2 = getappdata( gca, linker.residue2 );
0127         bp = [residue1.nucleotide,residue2.nucleotide];
0128         linker.line_handle = plot( [0,0],[0,0],<span class="string">'k'</span>,<span class="string">'linewidth'</span>,0.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0129         <span class="keyword">switch</span> bp
0130             <span class="keyword">case</span> {<span class="string">'AU'</span>,<span class="string">'UA'</span>,<span class="string">'GC'</span>,<span class="string">'CG'</span> } <span class="comment">% could also show double lines for G-C. Not my preference.</span>
0131                 set( linker.line_handle, <span class="string">'visible'</span>, <span class="string">'on'</span> );
0132             <span class="keyword">case</span> {<span class="string">'GU'</span>,<span class="string">'UG'</span>}
0133                 plot_settings = getappdata( gca, <span class="string">'plot_settings'</span> );
0134                 linker.symbol = <a href="create_LW_symbol.html" class="code" title="function h = create_LW_symbol( edge, orientation, bp_spacing );">create_LW_symbol</a>( <span class="string">'W'</span>, <span class="string">'C'</span>, plot_settings.bp_spacing );
0135                 set( linker.line_handle, <span class="string">'visible'</span>, <span class="string">'off'</span> ); <span class="comment">% convention for G*U in stems is to not show line.</span>
0136         <span class="keyword">end</span>
0137         setappdata( gca, linker.linker_tag, linker );
0138     <span class="keyword">case</span> { <span class="string">'noncanonical_pair'</span>, <span class="string">'long_range_stem_pair'</span> }
0139         linker.line_handle = plot( [0,0],[0,0],<span class="string">'k'</span>,<span class="string">'linewidth'</span>,0.5,<span class="string">'clipping'</span>,<span class="string">'off'</span>); <span class="comment">% dummy for now -- will get redrawn later.</span>
0140         <span class="keyword">if</span> ( linker.edge1 == linker.edge2 )
0141             linker.symbol = <a href="create_LW_symbol.html" class="code" title="function h = create_LW_symbol( edge, orientation, bp_spacing );">create_LW_symbol</a>( linker.edge1, linker.LW_orientation, plot_settings.bp_spacing );
0142         <span class="keyword">else</span>
0143             linker.symbol1 = <a href="create_LW_symbol.html" class="code" title="function h = create_LW_symbol( edge, orientation, bp_spacing );">create_LW_symbol</a>( linker.edge1, linker.LW_orientation, plot_settings.bp_spacing );
0144             linker.symbol2 = <a href="create_LW_symbol.html" class="code" title="function h = create_LW_symbol( edge, orientation, bp_spacing );">create_LW_symbol</a>( linker.edge2, linker.LW_orientation, plot_settings.bp_spacing );
0145         <span class="keyword">end</span>
0146         setappdata( gca, linker.linker_tag, linker );
0147     <span class="keyword">case</span> <span class="string">'arrow'</span>
0148         linker.line_handle = plot( [0,0],[0,0],<span class="string">'k'</span>,<span class="string">'linewidth'</span>,1.0,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0149         linker.arrow = patch( [0,0,0],[0,0,0],<span class="string">'k'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> );
0150         set( linker.line_handle, <span class="string">'linewidth'</span>, <a href="get_arrow_linewidth.html" class="code" title="function arrow_linewidth = get_arrow_linewidth( fontsize );">get_arrow_linewidth</a>( plot_settings.fontsize ) ); 
0151         setappdata( gca, linker.linker_tag, linker );
0152     <span class="keyword">case</span> <span class="string">'stack'</span>
0153         linker.line_handle = plot( [0,0],[0,0],<span class="string">'color'</span>,[0.8 0.8 0.8],<span class="string">'linestyle'</span>,<span class="string">':'</span>,<span class="string">'linewidth'</span>,1.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0154         setappdata( gca, linker.linker_tag, linker );
0155     <span class="keyword">case</span> <span class="string">'other_contact'</span>
0156         linker.line_handle = plot( [0,0],[0,0],<span class="string">'color'</span>,[0.5 0.5 1],<span class="string">'linestyle'</span>,<span class="string">':'</span>,<span class="string">'linewidth'</span>,1.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0157         setappdata( gca, linker.linker_tag, linker );
0158     <span class="keyword">case</span> <span class="string">'ligand'</span>
0159         linker.line_handle = plot( [0,0],[0,0],<span class="string">'color'</span>,[0.8 0.8 0.8],<span class="string">'linestyle'</span>,<span class="string">'-'</span>,<span class="string">'linewidth'</span>,1.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0160         setappdata( gca, linker.linker_tag, linker );
0161         send_to_back( linker.line_handle );
0162     <span class="keyword">case</span> {<span class="string">'tertcontact_interdomain'</span>,<span class="string">'tertiary_contact_interdomain'</span>}
0163         linker.type = <span class="string">'tertcontact_interdomain'</span>;
0164         linker.line_handle = plot( [0,0],[0,0],<span class="string">'color'</span>,[0.8 0.8 0.8],<span class="string">'linestyle'</span>,<span class="string">'-'</span>,<span class="string">'linewidth'</span>,0.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0165         linker.node1 = <a href="#_sub2" class="code" title="subfunction h = create_undercircle( bp_spacing );">create_undercircle</a>( plot_settings.bp_spacing );
0166         linker.node2 = <a href="#_sub2" class="code" title="subfunction h = create_undercircle( bp_spacing );">create_undercircle</a>( plot_settings.bp_spacing );
0167         linker.side_line1 = patch( [0,0],[0,0],[0.8 0.8 0.8],<span class="string">'edgecolor'</span>,<span class="string">'none'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0168         linker.side_line2 = patch( [0,0],[0,0],[0.8 0.8 0.8],<span class="string">'edgecolor'</span>,<span class="string">'none'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0169         linker.outarrow1  = patch( [0,0],[0,0],[0.8 0.8 0.8],<span class="string">'edgecolor'</span>,<span class="string">'none'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0170         linker.outarrow2  = patch( [0,0],[0,0],[0.8 0.8 0.8],<span class="string">'edgecolor'</span>,<span class="string">'none'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0171         setappdata( gca, linker.linker_tag, linker );
0172         send_to_back( linker.line_handle );
0173         send_to_back( linker.side_line1 );
0174         send_to_back( linker.side_line2 );
0175         send_to_back( linker.outarrow1 );
0176         send_to_back( linker.outarrow2 );
0177     <span class="keyword">case</span> {<span class="string">'tertcontact_intradomain'</span>,<span class="string">'tertiary_contact_intradomain'</span>}
0178         linker.type = <span class="string">'tertcontact_intradomain'</span>;
0179         linker.line_handle = plot( [0,0],[0,0],<span class="string">'color'</span>,[0.8 0.8 0.8],<span class="string">'linestyle'</span>,<span class="string">'-'</span>,<span class="string">'linewidth'</span>,2.5,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="comment">% dummy for now -- will get redrawn later.</span>
0180         <span class="comment">% don't need to make node1 -- should be covered by interdomain.</span>
0181         linker.node2 = <a href="#_sub2" class="code" title="subfunction h = create_undercircle( bp_spacing );">create_undercircle</a>( plot_settings.bp_spacing );
0182         setappdata( gca, linker.linker_tag, linker );
0183         send_to_back( linker.line_handle );
0184 <span class="keyword">end</span>
0185 
0186 
0187 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0188 <a name="_sub2" href="#_subfunctions" class="code">function h = create_undercircle( bp_spacing );</a>
0189 t = linspace(0, 2*pi);
0190 r = 10 * bp_spacing/2;
0191 x = r*cos(t);
0192 y = r*sin(t);
0193 h = patch( x,y,<span class="string">'w'</span>,<span class="string">'edgecolor'</span>,[0.8,0.8,0.8],<span class="string">'facecolor'</span>,<span class="string">'w'</span>,<span class="string">'linewidth'</span>,1);
0194 send_to_back( h );
0195 
0196 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0197 <span class="comment">% Linkers (base pairs &amp; arrow connectors)</span>
0198 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0199 <a name="_sub3" href="#_subfunctions" class="code">function too_short = linker_is_too_short_for_display( linker, plot_settings )</a>
0200 too_short = 0;
0201 residue1 = getappdata( gca, linker.residue1 );
0202 residue2 = getappdata( gca, linker.residue2 );
0203 <span class="keyword">if</span> ~isfield( linker, <span class="string">'relpos1'</span> ); linker = <a href="#_sub4" class="code" title="subfunction linker = set_linker_endpos( linker, res_tag, relpos_field, at_start );">set_linker_endpos</a>( linker, linker.residue1, <span class="string">'relpos1'</span>,  1 ); <span class="keyword">end</span>;
0204 <span class="keyword">if</span> ~isfield( linker, <span class="string">'relpos2'</span> ); linker = <a href="#_sub4" class="code" title="subfunction linker = set_linker_endpos( linker, res_tag, relpos_field, at_start );">set_linker_endpos</a>( linker, linker.residue2, <span class="string">'relpos2'</span>, -1 ); <span class="keyword">end</span>;
0205 <span class="keyword">if</span> isfield( linker, <span class="string">'relpos1'</span> ) &amp;&amp; isfield( linker, <span class="string">'relpos2'</span> )
0206     <span class="keyword">if</span> ~isfield( residue1, <span class="string">'plot_pos'</span> )  residue1.plot_pos = get_plot_pos( residue1, linker.relpos1(1,:) ); <span class="keyword">end</span>;
0207     <span class="keyword">if</span> ~isfield( residue2, <span class="string">'plot_pos'</span> )  residue2.plot_pos = get_plot_pos( residue2, linker.relpos2(<span class="keyword">end</span>,:) ); <span class="keyword">end</span>;
0208     <span class="comment">%if strcmp(linker.type,'arrow' ) [norm( residue1.plot_pos - residue2.plot_pos ), 1.5 * plot_settings.spacing ]; end</span>
0209     <span class="keyword">if</span> strcmp(linker.type,<span class="string">'stack'</span> )
0210         <span class="keyword">if</span> ( norm( residue1.plot_pos - residue2.plot_pos ) &lt; 1.5 * plot_settings.bp_spacing ) too_short = 1; <span class="keyword">return</span>; <span class="keyword">end</span>;
0211     <span class="keyword">end</span>
0212     <span class="keyword">if</span> strcmp(linker.type,<span class="string">'arrow'</span> )
0213         <span class="keyword">if</span> ( norm( residue1.plot_pos - residue2.plot_pos ) &lt; 1.5 * plot_settings.spacing ) too_short = 1;  <span class="keyword">return</span>; <span class="keyword">end</span>;
0214     <span class="keyword">end</span>
0215 <span class="keyword">end</span>
0216     
0217 <a name="_sub4" href="#_subfunctions" class="code">function linker = set_linker_endpos( linker, res_tag, relpos_field, at_start );</a>
0218 <span class="keyword">if</span> ~isfield( linker, relpos_field )
0219     linker = setfield( linker, relpos_field, [0,0]);
0220 <span class="keyword">end</span>;
0221 relpos = getfield( linker, relpos_field );
0222 residue = getappdata( gca, res_tag );
0223 <span class="keyword">if</span> isfield( residue,<span class="string">'relpos'</span> )
0224     <span class="keyword">if</span> ( at_start &gt; 0) relpos(1,:)   = residue.relpos;
0225     <span class="keyword">else</span>               relpos(<span class="keyword">end</span>,:) = residue.relpos;
0226     <span class="keyword">end</span>
0227 <span class="keyword">end</span>
0228 linker = setfield( linker, relpos_field, relpos);
0229 <span class="comment">% does not seem necessary...</span>
0230 <span class="comment">%setappdata( gca, linker.linker_tag, linker );</span>
0231 
0232 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0233 <a name="_sub5" href="#_subfunctions" class="code">function update_arrow( h, ctr, v, spacing, add_stem );</a>
0234 x = v * 1.5 * [0 1; -1 0]; <span class="comment">% cross direction</span>
0235 a  = [ <span class="keyword">...</span>
0236     ctr - spacing/3*v+spacing/5*x;
0237     ctr - spacing/6*v+spacing/10*x;
0238     ctr + spacing*0*v+spacing/15*x;
0239     ctr + spacing/6*v+spacing/20*x;
0240     ctr + spacing/2*v;
0241     ctr + spacing/6*v-spacing/20*x;
0242     ctr - spacing*0*v-spacing/15*x;
0243     ctr - spacing/6*v-spacing/10*x;
0244     ctr - spacing/3*v-spacing/5*x <span class="keyword">...</span>
0245     ];
0246 <span class="keyword">if</span> exist( <span class="string">'add_stem'</span>, <span class="string">'var'</span> ) &amp; add_stem
0247     a = [ a; <span class="keyword">...</span>
0248         ctr - spacing/3*v-spacing*0.075*x; 
0249         ctr - spacing/2*v-spacing*0.075*x; 
0250         ctr - spacing/2*v+spacing*0.075*x; 
0251         ctr - spacing/3*v+spacing*0.075*x <span class="keyword">...</span>
0252         ];
0253 <span class="keyword">end</span>
0254     
0255 set( h, <span class="string">'xdata'</span>, <span class="keyword">...</span>
0256     a(:,1) );
0257 set( h, <span class="string">'ydata'</span>, <span class="keyword">...</span>
0258     a(:,2) );
0259 
0260 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0261 <a name="_sub6" href="#_subfunctions" class="code">function linker = update_arrow_style( linker, plot_settings )</a>
0262 color = <span class="string">'k'</span>;  <span class="comment">%black is default</span>
0263 residue1 = getappdata(gca,linker.residue1);
0264 <span class="keyword">if</span> ( isfield( plot_settings, <span class="string">'color_arrows'</span> ) &amp; plot_settings.color_arrows &amp; isfield( residue1, <span class="string">'rgb_color'</span> ) ); color = residue1.rgb_color; <span class="keyword">end</span>
0265 set( linker.line_handle, <span class="string">'color'</span>,color);
0266 set( linker.arrow, <span class="string">'edgecolor'</span>,color );
0267 set( linker.arrow, <span class="string">'facecolor'</span>,color );
0268 arrow_linewidth = <a href="get_arrow_linewidth.html" class="code" title="function arrow_linewidth = get_arrow_linewidth( fontsize );">get_arrow_linewidth</a>( plot_settings.fontsize );
0269 set( linker.line_handle, <span class="string">'linewidth'</span>, arrow_linewidth );
0270 
0271 
0272 
0273 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0274 <a name="_sub7" href="#_subfunctions" class="code">function linker = update_extra_arrows( linker, plot_pos, num_pos1, plot_settings );</a>
0275 num_extra_arrows = size(plot_pos,1)-2;
0276 <span class="keyword">if</span> ~isfield( linker, <span class="string">'extra_arrows'</span> )
0277     linker.extra_arrows = {};
0278     <span class="keyword">for</span> i = 1:num_extra_arrows
0279         linker.extra_arrows{i} = patch( [0,0,0],[0,0,0],<span class="string">'k'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> );;
0280     <span class="keyword">end</span>
0281 <span class="keyword">end</span>
0282 
0283 <span class="comment">% make the right number of extra arrows</span>
0284 <span class="keyword">for</span> i = num_extra_arrows+1: length( linker.extra_arrows ); delete( linker.extra_arrows{i} ); <span class="keyword">end</span>
0285 <span class="keyword">for</span> i = length( linker.extra_arrows )+1 : num_extra_arrows;  linker.extra_arrows{i} = patch( [0,0,0],[0,0,0],<span class="string">'k'</span>,<span class="string">'clipping'</span>,<span class="string">'off'</span> ); <span class="keyword">end</span>;
0286 linker.extra_arrows = linker.extra_arrows(1:num_extra_arrows);
0287 
0288 <span class="comment">% These are extra_arrows. Skip the 'usual' arrow that connects plot_pos1 and plot_pos2.</span>
0289 which_segment = [1:(num_pos1-1), (num_pos1+1):size(plot_pos,1)-1];
0290 assert( num_extra_arrows == length( which_segment) );
0291 <span class="keyword">for</span> i = 1:num_extra_arrows;
0292     pos1 = plot_pos( which_segment(i), : );
0293     pos2 = plot_pos( which_segment(i)+1, : );
0294     ctr = (pos1+pos2)/2; <span class="comment">% center of connecting line</span>
0295     v = pos2 - pos1; v = v/norm(v); <span class="comment">% unit vector from res1 to res2</span>
0296     show_arrow = plot_settings.show_extra_arrows &amp; norm( pos2 - pos1 ) &gt;= 5 * plot_settings.bp_spacing;
0297     <span class="keyword">if</span> ( show_arrow )  
0298         set( linker.extra_arrows{i}, <span class="string">'visible'</span>,<span class="string">'on'</span> );
0299         <a href="#_sub5" class="code" title="subfunction update_arrow( h, ctr, v, spacing, add_stem );">update_arrow</a>( linker.extra_arrows{ i }, ctr, v, plot_settings.spacing ); 
0300     <span class="keyword">else</span>; 
0301         set( linker.extra_arrows{i}, <span class="string">'visible'</span>,<span class="string">'off'</span> );
0302     <span class="keyword">end</span>;
0303 <span class="keyword">end</span>
0304 
0305 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0306 <a name="_sub8" href="#_subfunctions" class="code">function pos1 = nudge_pos( pos1, pos2, bp_spacing );</a>
0307 v = pos2 - pos1; 
0308 v = v/norm(v);
0309 pos1 = pos1 +  (bp_spacing/5)*v;
0310 
0311 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0312 <a name="_sub9" href="#_subfunctions" class="code">function update_symbol( h, pos, v, which_symbol, bp_spacing );</a>
0313 vertices = get(h,<span class="string">'Vertices'</span>);
0314 numv = size(vertices,1);
0315 rot = atan2( v(2), v(1) ); <span class="comment">% rotate so that symbol 'aligns' with line.</span>
0316 <span class="keyword">if</span> which_symbol == 1; rot = rot + pi; <span class="keyword">end</span>;
0317 <span class="keyword">switch</span> numv
0318     <span class="keyword">case</span> 3 <span class="comment">% triangle</span>
0319         t = rot+[0 2*pi/3 2*pi*2/3];
0320         r = bp_spacing/10 * 1.5*sqrt(3)/2;
0321     <span class="keyword">case</span> 4 <span class="comment">% square</span>
0322         t = rot+[0 pi/2 pi 3*pi/2]+pi/4;
0323         r = bp_spacing/10 * sqrt(2);
0324     <span class="keyword">otherwise</span> <span class="comment">% circle</span>
0325         t = rot+linspace(0, 2*pi);
0326         r = bp_spacing/10;
0327 <span class="keyword">end</span>
0328 vertices = [r*cos(t); r*sin(t) ]' + repmat( pos, size(vertices,1), 1 );
0329 assert( numv == size( vertices, 1 ) );
0330 set( h, <span class="string">'xdata'</span>, vertices(:,1) );
0331 set( h, <span class="string">'ydata'</span>, vertices(:,2) );
0332 
0333 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0334 <a name="_sub10" href="#_subfunctions" class="code">function base_paired = check_for_base_pair( res_tag1, res_tag2 )</a>
0335 residue1 = getappdata( gca, res_tag1 );
0336 base_paired = false;
0337 <span class="keyword">for</span> i = 1:length( residue1.linkers )
0338     linker_tag = residue1.linkers{i};
0339     <span class="keyword">if</span> ~isappdata( gca, linker_tag ) fprintf( <span class="string">'Could not find linker %s\n'</span>, linker_tag ); <span class="keyword">continue</span>; <span class="keyword">end</span>;
0340     linker = getappdata( gca, linker_tag );
0341     <span class="keyword">if</span> strcmp( linker.type,<span class="string">'noncanonical_pair'</span> ) | strcmp( linker.type,<span class="string">'stem_pair'</span> )
0342         <span class="keyword">if</span> ( strcmp( linker.residue1 , res_tag1 ) &amp;&amp; strcmp( linker.residue2, res_tag2 ) ) 
0343             base_paired = true; <span class="keyword">return</span>;
0344         <span class="keyword">end</span>
0345         <span class="keyword">if</span> ( strcmp( linker.residue1 , res_tag2 ) &amp;&amp; strcmp( linker.residue2, res_tag1 ) ) 
0346             base_paired = true; <span class="keyword">return</span>;
0347         <span class="keyword">end</span>
0348     <span class="keyword">end</span>
0349 <span class="keyword">end</span>
0350 
0351 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0352 <a name="_sub11" href="#_subfunctions" class="code">function linker = update_tertiary_contact( linker, plot_pos, plot_settings );</a>
0353 <span class="keyword">if</span> ~isfield( linker, <span class="string">'tertiary_contact'</span> ) linker
0354 <span class="keyword">end</span>
0355 tertiary_contact = getappdata( gca, linker.tertiary_contact );
0356 <span class="keyword">if</span> isfield( plot_settings, <span class="string">'show_tertiary_contacts'</span> )
0357     <span class="keyword">if</span> plot_settings.show_tertiary_contacts; visible = <span class="string">'on'</span>; <span class="keyword">else</span>; visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0358     linker = set_linker_visibility( linker, visible );
0359 <span class="keyword">end</span>
0360 
0361 residue1 = getappdata( gca, tertiary_contact.associated_residues1{1} );
0362 residue2 = getappdata( gca, tertiary_contact.associated_residues2{1} );
0363 
0364 <span class="keyword">if</span> strcmp( linker.type, <span class="string">'tertcontact_interdomain'</span> )
0365     segwidth = plot_settings.bp_spacing/16;
0366     <span class="keyword">if</span> isfield( tertiary_contact,<span class="string">'linkers'</span>);
0367         segwidth = length(tertiary_contact.linkers) * plot_settings.bp_spacing/160;
0368     <span class="keyword">end</span>
0369     
0370     <span class="comment">% double color lines for interdomain;</span>
0371     side_line1_pos = []; side_line2_pos = [];
0372     <span class="keyword">for</span> i = 1:length( plot_pos ) - 1
0373         segv = plot_pos(i+1,:) - plot_pos(i,:);
0374         segv = segv/norm(segv);
0375         segv = segv * [0 1; -1 0] * segwidth; <span class="comment">% rotate</span>
0376         side_line1_pos = [side_line1_pos; plot_pos(i,:)-segv; plot_pos(i+1,:)-segv ];
0377         side_line2_pos = [side_line2_pos; plot_pos(i,:)+segv; plot_pos(i+1,:)+segv ];
0378     <span class="keyword">end</span>
0379     set( linker.side_line1, <span class="string">'xdata'</span>, [side_line1_pos(:,1); plot_pos(end:-1:1,1)], <span class="string">'ydata'</span>, [side_line1_pos(:,2); plot_pos(end:-1:1,2)] );
0380     set( linker.side_line2, <span class="string">'xdata'</span>, [side_line2_pos(:,1); plot_pos(end:-1:1,1)], <span class="string">'ydata'</span>, [side_line2_pos(:,2); plot_pos(end:-1:1,2)] );
0381 
0382     <span class="keyword">if</span> ( isfield( linker, <span class="string">'show_split_arrows'</span> )  &amp;&amp; linker.show_split_arrows ) arrow_visible = <span class="string">'on'</span>; <span class="keyword">else</span>; arrow_visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0383     outarrow_size = 1.5*plot_settings.spacing;
0384     linker = <a href="#_sub13" class="code" title="subfunction linker = update_outarrow( linker, plot_pos, residue, outarrow_size, outarrow_fieldname, outarrow_label_fieldname, arrow_visible, plot_settings, which_res )">update_outarrow</a>( linker, plot_pos, residue1, outarrow_size,  <span class="string">'outarrow1'</span>,<span class="string">'outarrow_label1'</span>, arrow_visible, plot_settings, 1 );
0385     linker = <a href="#_sub13" class="code" title="subfunction linker = update_outarrow( linker, plot_pos, residue, outarrow_size, outarrow_fieldname, outarrow_label_fieldname, arrow_visible, plot_settings, which_res )">update_outarrow</a>( linker, plot_pos, residue2, outarrow_size,  <span class="string">'outarrow2'</span>,<span class="string">'outarrow_label2'</span>, arrow_visible, plot_settings, 2 );
0386     <span class="keyword">if</span> ( isfield( linker, <span class="string">'show_split_arrows'</span> )  &amp;&amp; linker.show_split_arrows &amp;&amp; isfield( plot_settings,<span class="string">'show_split_arrow_lines'</span>) )
0387         <span class="keyword">if</span> ( plot_settings.show_split_arrow_lines ) line_visible = <span class="string">'on'</span>; <span class="keyword">else</span>; line_visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0388         set( linker.line_handle, <span class="string">'visible'</span>,line_visible );
0389         <span class="keyword">if</span> isfield( linker, <span class="string">'vtx'</span> )
0390             vtx_visible = line_visible;
0391             <span class="keyword">if</span> isfield( plot_settings, <span class="string">'show_linker_controls'</span>) &amp; ~plot_settings.show_linker_controls;  vtx_visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0392             <span class="keyword">for</span> i = 1:length( linker.vtx ), set( linker.vtx{i}, <span class="string">'visible'</span>, vtx_visible ); <span class="keyword">end</span>;
0393         <span class="keyword">end</span>;
0394     <span class="keyword">end</span>
0395 <span class="keyword">end</span>
0396 
0397 <span class="comment">% colors</span>
0398 set( linker.line_handle, <span class="string">'xdata'</span>, plot_pos(:,1), <span class="string">'ydata'</span>, plot_pos(:,2) );
0399 
0400 <span class="keyword">if</span> isfield( residue1, <span class="string">'rgb_color'</span> ) rescolor1 = residue1.rgb_color; <span class="keyword">else</span>; rescolor1 = [0,0,0]; <span class="keyword">end</span>;
0401 <span class="keyword">if</span> isfield( residue2, <span class="string">'rgb_color'</span> ) rescolor2 = residue2.rgb_color; <span class="keyword">else</span>; rescolor2 = [0,0,0]; <span class="keyword">end</span>;
0402 <span class="comment">% make color informative about *other* domain</span>
0403 color1 = fade_color( rescolor2 );
0404 color2 = fade_color( rescolor1 );
0405 <span class="keyword">if</span> isfield( residue1, <span class="string">'ligand_partners'</span> ) 
0406     color1 = <a href="#_sub17" class="code" title="subfunction linecolor = get_single_color_for_ligand_linker( residue1, residue2 );">get_single_color_for_ligand_linker</a>( residue1, residue2 );
0407     color2 = color1;
0408 <span class="keyword">end</span>
0409 
0410 <span class="keyword">if</span> isfield(plot_settings,<span class="string">'tertiary_contact_domain_coloring'</span> ) &amp; ~plot_settings.tertiary_contact_domain_coloring
0411     color1 = [0.9 0.9 0.9];
0412     color2 = [0.9 0.9 0.9];
0413 <span class="keyword">end</span>
0414 
0415 <span class="keyword">if</span> strcmp( linker.type, <span class="string">'tertcontact_interdomain'</span> )
0416     set( linker.node1, <span class="string">'edgecolor'</span>,color1);
0417     set( linker.node2, <span class="string">'edgecolor'</span>,color2);
0418     set( linker.side_line1, <span class="string">'facecolor'</span>, color1 );
0419     set( linker.side_line2, <span class="string">'facecolor'</span>, color2 );
0420     <span class="keyword">if</span> isfield( linker, <span class="string">'outarrow1'</span> ); set( linker.outarrow1, <span class="string">'facecolor'</span>,rescolor2 ); <span class="keyword">end</span>;  
0421     <span class="keyword">if</span> isfield( linker, <span class="string">'outarrow2'</span> ); set( linker.outarrow2, <span class="string">'facecolor'</span>,rescolor1 ); <span class="keyword">end</span>;
0422     <span class="keyword">if</span> isfield( linker, <span class="string">'outarrow_label1'</span> ); set( linker.outarrow_label1, <span class="string">'color'</span>,rescolor2 ); <span class="keyword">end</span>;  
0423     <span class="keyword">if</span> isfield( linker, <span class="string">'outarrow_label2'</span> ); set( linker.outarrow_label2, <span class="string">'color'</span>,rescolor1 ); <span class="keyword">end</span>;
0424     linker_visible = get(linker.node1,<span class="string">'visible'</span>);
0425     <span class="keyword">if</span> isfield( linker, <span class="string">'show_split_arrows'</span> ) &amp; linker.show_split_arrows
0426         set( linker.outarrow1, <span class="string">'visible'</span>, linker_visible );
0427         set( linker.outarrow2, <span class="string">'visible'</span>, linker_visible );
0428         set( linker.side_line1, <span class="string">'visible'</span>,<span class="string">'off'</span>);
0429         set( linker.side_line2, <span class="string">'visible'</span>,<span class="string">'off'</span>);
0430     <span class="keyword">else</span>
0431         set( linker.outarrow1, <span class="string">'visible'</span>, <span class="string">'off'</span> );
0432         set( linker.outarrow2, <span class="string">'visible'</span>, <span class="string">'off'</span> );
0433         set( linker.side_line1, <span class="string">'visible'</span>,linker_visible );
0434         set( linker.side_line2, <span class="string">'visible'</span>,linker_visible );
0435     <span class="keyword">end</span>
0436 <span class="keyword">else</span>
0437     assert( strcmp( linker.type, <span class="string">'tertcontact_intradomain'</span> ) );
0438     set( linker.line_handle, <span class="string">'linewidth'</span>, <a href="get_arrow_linewidth.html" class="code" title="function arrow_linewidth = get_arrow_linewidth( fontsize );">get_arrow_linewidth</a>( plot_settings.fontsize ) );
0439     <span class="keyword">if</span> any( strcmp( tertiary_contact.associated_residues1, linker.residue1 ) ) <span class="comment">% in domain 1</span>
0440         set( linker.node2, <span class="string">'edgecolor'</span>,color1);
0441         set( linker.line_handle, <span class="string">'color'</span>,color1);
0442     <span class="keyword">else</span> <span class="comment">% in domain 2</span>
0443         assert( any( strcmp( tertiary_contact.associated_residues2, linker.residue1 ) ) );
0444         set( linker.node2, <span class="string">'edgecolor'</span>,color2);
0445         set( linker.line_handle, <span class="string">'color'</span>,color2);
0446     <span class="keyword">end</span>
0447 <span class="keyword">end</span>
0448 
0449 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0450 <a name="_sub12" href="#_subfunctions" class="code">function linker = update_tertiary_arrow_label( linker, arrow_label, default_plot_pos, arrow_visible, plot_settings );</a>
0451 <span class="keyword">if</span> ~isfield( linker, arrow_label )
0452     h = text( 0, 0, <span class="string">'.'</span> );
0453     linker = setfield( linker, arrow_label, h );
0454     setappdata( gca, linker.linker_tag, linker );
0455 <span class="keyword">end</span>
0456 tertiary_contact = getappdata( gca, linker.tertiary_contact );
0457 h = getfield(linker, arrow_label);
0458 <span class="keyword">if</span> ~isvalid( h ) <span class="keyword">return</span>; <span class="keyword">end</span>;
0459 <span class="keyword">if</span> ~isfield( tertiary_contact, <span class="string">'name'</span> ) tertiary_contact = update_tertiary_contact_name( tertiary_contact, 0 ); <span class="keyword">end</span>;
0460 set( h, <span class="string">'string'</span>, strrep(tertiary_contact.name,<span class="string">'_'</span>,<span class="string">'-'</span>), <span class="string">'Position'</span>, default_plot_pos, <span class="string">'visible'</span>,arrow_visible,<span class="string">'fontsize'</span>, plot_settings.fontsize*0.75 );
0461 
0462 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0463 <a name="_sub13" href="#_subfunctions" class="code">function linker = update_outarrow( linker, plot_pos, residue, outarrow_size, outarrow_fieldname, outarrow_label_fieldname, arrow_visible, plot_settings, which_res )</a>
0464 <span class="keyword">if</span> (isfield(plot_settings,<span class="string">'image_representation'</span>) &amp; ~strcmp(plot_settings.image_representation,<span class="string">'image_boundary'</span>) ) <span class="keyword">return</span>; <span class="keyword">end</span>;
0465 <span class="keyword">if</span> ~isfield( linker, outarrow_fieldname ) <span class="keyword">return</span>; <span class="keyword">end</span>;
0466 
0467 <span class="comment">% if this is the ligand side of an interdomain outarrow,</span>
0468 <span class="comment">% only show arrow if its the first split one.</span>
0469 <span class="keyword">if</span> which_res == 1 &amp;&amp; isfield( residue, <span class="string">'ligand_partners'</span> ) arrow_visible = <a href="#_sub14" class="code" title="subfunction  arrow_visible = check_first_linker_outarrow( linker, residue, arrow_visible );">check_first_linker_outarrow</a>( linker, residue, arrow_visible ); <span class="keyword">end</span>;
0470 
0471 <span class="keyword">if</span> ( which_res == 2 ) plot_pos = plot_pos(end:-1:1,:); <span class="keyword">end</span>;
0472 <span class="keyword">if</span> isfield( residue, <span class="string">'image_handle'</span> )
0473     [v,start_pos,pointing_out_of_polygon] = <a href="first_crossing.html" class="code" title="function [v,start_pos,pointing_out_of_polygon] = first_crossing( polygon, plot_pos );">first_crossing</a>( [get(residue.image_handle,<span class="string">'XData'</span>),get(residue.image_handle,<span class="string">'YData'</span>)], plot_pos );
0474     <span class="keyword">if</span> ( ~pointing_out_of_polygon ) arrow_visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0475 <span class="keyword">else</span>
0476     v = plot_pos(2,:) - plot_pos(1,:);  v = v /norm(v);
0477     start_pos = plot_pos(1,:);
0478 <span class="keyword">end</span>
0479 outarrow = getfield( linker, outarrow_fieldname );
0480 <span class="keyword">if</span> ~arrow_visible; set( outarrow, <span class="string">'visible'</span>,<span class="string">'on'</span> ); <span class="keyword">else</span>;  set( outarrow, <span class="string">'visible'</span>,<span class="string">'off'</span> ); <span class="keyword">end</span>;
0481 <a href="#_sub5" class="code" title="subfunction update_arrow( h, ctr, v, spacing, add_stem );">update_arrow</a>( getfield(linker,outarrow_fieldname), start_pos + v*outarrow_size*0.5, v, outarrow_size, 1 );
0482 linker = <a href="#_sub12" class="code" title="subfunction linker = update_tertiary_arrow_label( linker, arrow_label, default_plot_pos, arrow_visible, plot_settings );">update_tertiary_arrow_label</a>( linker, outarrow_label_fieldname, start_pos + v*outarrow_size, arrow_visible, plot_settings );
0483 set_text_alignment( getfield( linker, outarrow_label_fieldname ), v );
0484 
0485 
0486 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0487 <a name="_sub14" href="#_subfunctions" class="code">function  arrow_visible = check_first_linker_outarrow( linker, residue, arrow_visible );</a>
0488 sister_linker_tags = get_tags( <span class="string">'Linker'</span>,<span class="string">'interdomain'</span>,residue.linkers );
0489 <span class="keyword">for</span> i = 1:length( sister_linker_tags )
0490     sister_linker = getappdata( gca, sister_linker_tags{i} );
0491     <span class="keyword">if</span> ~isfield( sister_linker, <span class="string">'show_split_arrows'</span> ) || ~sister_linker.show_split_arrows; <span class="keyword">continue</span>; <span class="keyword">end</span>
0492     <span class="keyword">if</span> ~strcmp(sister_linker.linker_tag,linker.linker_tag);
0493         arrow_visible = <span class="string">'off'</span>;
0494     <span class="keyword">end</span>
0495     <span class="keyword">return</span>;
0496 <span class="keyword">end</span>
0497 
0498 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0499 <a name="_sub15" href="#_subfunctions" class="code">function setting = show_tertiary_noncanonical_pair( linker, plot_settings )</a>
0500 <span class="comment">% for show/hide interdomain_noncanonical_pairs</span>
0501 setting = 1;
0502 <span class="keyword">if</span> ~isfield( plot_settings, <span class="string">'show_tertiary_noncanonical_pairs'</span> ) <span class="keyword">return</span>; <span class="keyword">end</span>;
0503 <span class="keyword">if</span> ~plot_settings.show_tertiary_noncanonical_pairs
0504     <span class="keyword">if</span> isfield( linker, <span class="string">'tertiary_contact'</span> ) &amp;&amp; length(linker.tertiary_contact) &gt; 0
0505         setting = 0;
0506     <span class="keyword">end</span>
0507 <span class="keyword">end</span>
0508 <span class="keyword">return</span>;
0509 
0510 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0511 <a name="_sub16" href="#_subfunctions" class="code">function update_ligand_linker( linker, plot_settings );</a>
0512 <span class="keyword">if</span> ~isfield( plot_settings, <span class="string">'show_ligand_linkers'</span> ); <span class="keyword">return</span>; <span class="keyword">end</span>;
0513 <span class="keyword">if</span> ( plot_settings.show_ligand_linkers ) visible = <span class="string">'on'</span>; <span class="keyword">else</span>; visible = <span class="string">'off'</span>; <span class="keyword">end</span>;
0514 set( linker.line_handle, <span class="string">'visible'</span>, visible );
0515 residue1 = getappdata( gca, linker.residue1 );
0516 residue2 = getappdata( gca, linker.residue2 );
0517 linecolor = <a href="#_sub17" class="code" title="subfunction linecolor = get_single_color_for_ligand_linker( residue1, residue2 );">get_single_color_for_ligand_linker</a>( residue1, residue2 );
0518 set( linker.line_handle, <span class="string">'color'</span>, linecolor );
0519 
0520 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0521 <a name="_sub17" href="#_subfunctions" class="code">function linecolor = get_single_color_for_ligand_linker( residue1, residue2 );</a>
0522 <span class="keyword">if</span> isfield( residue1, <span class="string">'rgb_color'</span> ) rescolor1 = residue1.rgb_color; <span class="keyword">else</span>; rescolor1 = [0,0,0]; <span class="keyword">end</span>;
0523 <span class="keyword">if</span> isfield( residue2, <span class="string">'rgb_color'</span> ) rescolor2 = residue2.rgb_color; <span class="keyword">else</span>; rescolor2 = [0,0,0]; <span class="keyword">end</span>;
0524 linecolor = rescolor1;
0525 <span class="keyword">if</span> all( rescolor1 == 0 ); linecolor = rescolor2; <span class="keyword">end</span>; 
0526 linecolor = fade_color( linecolor );
0527 
0528 
0529     
0530</pre></div>
<hr><address>Generated on Sat 14-Jul-2018 16:23:59 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>